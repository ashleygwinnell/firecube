<HTML>
<HEAD>
<TITLE>
Renderer.cpp
</TITLE>
</HEAD>
<BODY>
<PRE>
<font color="blue">#include</font> <font color="maroon">&#60;string&#62;</font>
<font color="blue">#include</font> <font color="maroon">&#60;vector&#62;</font>
<font color="blue">#include</font> <font color="maroon">&#60;map&#62;</font>
<font color="blue">#include</font> <font color="maroon">&#60;queue&#62;</font>
<font color="blue">#include</font> <font color="maroon">&#60;fstream&#62;</font>
<font color="blue">#include</font> <font color="maroon">&#60;sstream&#62;</font>
<font color="blue">#include</font> <font color="maroon">&#60;boost/shared_ptr.hpp&#62;</font>
<font color="blue">#include</font> <font color="maroon">&#60;boost/weak_ptr.hpp&#62;</font>
<font color="blue">using</font> <font color="blue">namespace</font> std;
<font color="blue">#include</font> <font color="maroon">&#60;SDL.h&#62;</font>
<font color="blue">#include</font> <font color="maroon">&#60;windows.h&#62;</font>
<font color="blue">#include</font> <font color="maroon">&#60;ft2build.h&#62;</font>
<font color="blue">#include</font> FT_FREETYPE_H
<font color="blue">#include</font> <font color="maroon">"GLee.h"</font>

<font color="blue">#include</font> <font color="maroon">"utils.h"</font>  
<font color="blue">#include</font> <font color="maroon">"Logger.h"</font>
<font color="blue">#include</font> <font color="maroon">"ResourceManager.h"</font>
<font color="blue">#include</font> <font color="maroon">"Timer.h"</font>
<font color="blue">#include</font> <font color="maroon">"MyMath.h"</font> 
<font color="blue">#include</font> <font color="maroon">"BoundingBox.h"</font>
<font color="blue">#include</font> <font color="maroon">"Texture.h"</font>        
<font color="blue">#include</font> <font color="maroon">"Buffer.h"</font>
<font color="blue">#include</font> <font color="maroon">"Shaders.h"</font>
<font color="blue">#include</font> <font color="maroon">"Geometry.h"</font>   
<font color="blue">#include</font> <font color="maroon">"FrameBuffer.h"</font>
<font color="blue">#include</font> <font color="maroon">"Image.h"</font>
<font color="blue">#include</font> <font color="maroon">"Font.h"</font>
<font color="blue">#include</font> <font color="maroon">"RenderQueue.h"</font>
<font color="blue">#include</font> <font color="maroon">"Renderer.h"</font>
<font color="blue">#include</font> <font color="maroon">"Application.h"</font>
<font color="blue">#include</font> <font color="maroon">"privateFont.h"</font>
<font color="blue">#include</font> <font color="maroon">"Light.h"</font>
<font color="blue">#include</font> <font color="maroon">"Node.h"</font>

<font color="blue">using</font> <font color="blue">namespace</font> FireCube;
Program textShader;
Buffer textVertexBuffer;
Buffer textUvBuffer;
TextureManager <font color="black">*</font>currentTextureManager<font color="black">=</font>NULL;
ShaderManager <font color="black">*</font>currentShaderManager<font color="black">=</font>NULL;
FontManager <font color="black">*</font>currentFontManager<font color="black">=</font>NULL;
ShaderGenerator <font color="black">*</font>currentShaderGenerator<font color="black">=</font>NULL;
Program globalProgram;
map<font color="black">&#60;</font>string, Technique<font color="black">&#62;</font> techniques;
RenderState<font color="black">:</font><font color="black">:</font>RenderState<font color="black">(</font><font color="black">)</font> <font color="black">:</font> directionalLighting<font color="black">(</font><font color="blue">false</font><font color="black">)</font>, diffuseTexture<font color="black">(</font><font color="blue">false</font><font color="black">)</font>, fog<font color="black">(</font><font color="blue">false</font><font color="black">)</font>,pointLighting<font color="black">(</font><font color="blue">false</font><font color="black">)</font>,normalTexture<font color="black">(</font><font color="blue">false</font><font color="black">)</font>
<font color="black">{</font>

<font color="black">}</font>
<font color="blue">void</font> RenderState<font color="black">:</font><font color="black">:</font>FromMaterial<font color="black">(</font>Material mat<font color="black">)</font>
<font color="black">{</font>
    <font color="blue">if</font> <font color="black">(</font>mat.GetDiffuseTexture<font color="black">(</font><font color="black">)</font><font color="black">)</font>
        <font color="blue">this</font><font color="black">-</font><font color="black">&#62;</font>diffuseTexture<font color="black">=</font><font color="blue">true</font>;
    <font color="blue">if</font> <font color="black">(</font>mat.GetNormalTexture<font color="black">(</font><font color="black">)</font><font color="black">)</font>
        <font color="blue">this</font><font color="black">-</font><font color="black">&#62;</font>normalTexture<font color="black">=</font><font color="blue">true</font>;
<font color="black">}</font>
<font color="blue">void</font> RenderState<font color="black">:</font><font color="black">:</font>SetDirectionalLighting<font color="black">(</font><font color="blue">bool</font> enable<font color="black">)</font>
<font color="black">{</font>
    directionalLighting<font color="black">=</font>enable;
<font color="black">}</font>
<font color="blue">void</font> RenderState<font color="black">:</font><font color="black">:</font>SetPointLighting<font color="black">(</font><font color="blue">bool</font> enable<font color="black">)</font>
<font color="black">{</font>
    pointLighting<font color="black">=</font>enable;
<font color="black">}</font>

<font color="blue">void</font> RenderState<font color="black">:</font><font color="black">:</font>SetFog<font color="black">(</font><font color="blue">bool</font> enable<font color="black">)</font>
<font color="black">{</font>
    fog<font color="black">=</font>enable;
<font color="black">}</font>
<font color="blue">unsigned</font> <font color="blue">int</font> RenderState<font color="black">:</font><font color="black">:</font>ToInt<font color="black">(</font><font color="black">)</font> <font color="blue">const</font>
<font color="black">{</font>
    <font color="blue">unsigned</font> <font color="blue">int</font> ret<font color="black">=</font><font color="maroon">0</font>;
    <font color="blue">if</font> <font color="black">(</font>directionalLighting<font color="black">)</font>
        ret<font color="black">|</font><font color="black">=</font><font color="maroon">1</font>;
    <font color="blue">if</font> <font color="black">(</font>fog<font color="black">)</font>
        ret<font color="black">|</font><font color="black">=</font><font color="maroon">2</font>;
    <font color="blue">if</font> <font color="black">(</font>diffuseTexture<font color="black">)</font>
        ret<font color="black">|</font><font color="black">=</font><font color="maroon">4</font>;
    <font color="blue">if</font> <font color="black">(</font>pointLighting<font color="black">)</font>
        ret<font color="black">|</font><font color="black">=</font><font color="maroon">8</font>;
    <font color="blue">if</font> <font color="black">(</font>normalTexture<font color="black">)</font>
        ret<font color="black">|</font><font color="black">=</font><font color="maroon">16</font>;
    <font color="blue">return</font> ret;
<font color="black">}</font>

<font color="blue">void</font> Renderer<font color="black">:</font><font color="black">:</font>Clear<font color="black">(</font>vec4 color,<font color="blue">float</font> depth<font color="black">)</font>
<font color="black">{</font>
    glClearColor<font color="black">(</font>color.x,color.y,color.z,color.w<font color="black">)</font>;
    glClearDepth<font color="black">(</font>depth<font color="black">)</font>;
    glClear<font color="black">(</font>GL_COLOR_BUFFER_BIT <font color="black">|</font> GL_DEPTH_BUFFER_BIT<font color="black">)</font>;
<font color="black">}</font>
<font color="blue">void</font> Renderer<font color="black">:</font><font color="black">:</font>SetModelViewMatrix<font color="black">(</font>mat4 <font color="black">&</font>m<font color="black">)</font>
<font color="black">{</font>
    glMatrixMode<font color="black">(</font>GL_MODELVIEW<font color="black">)</font>;
    glLoadMatrixf<font color="black">(</font>m.m<font color="black">)</font>;
<font color="black">}</font>
<font color="blue">void</font> Renderer<font color="black">:</font><font color="black">:</font>SetTextureMatrix<font color="black">(</font>mat4 <font color="black">&</font>m,<font color="blue">int</font> unit<font color="black">)</font>
<font color="black">{</font>
    glActiveTexture<font color="black">(</font>GL_TEXTURE0<font color="black">+</font>unit<font color="black">)</font>;
    glMatrixMode<font color="black">(</font>GL_TEXTURE<font color="black">)</font>;
    glLoadMatrixf<font color="black">(</font>m.m<font color="black">)</font>;
<font color="black">}</font>
<font color="blue">void</font> Renderer<font color="black">:</font><font color="black">:</font>SetProjectionMatrix<font color="black">(</font>mat4 <font color="black">&</font>m<font color="black">)</font>
<font color="black">{</font>
    glMatrixMode<font color="black">(</font>GL_PROJECTION<font color="black">)</font>;
    glLoadMatrixf<font color="black">(</font>m.m<font color="black">)</font>;
<font color="black">}</font>
<font color="blue">void</font> FIRECUBE_API Renderer<font color="black">:</font><font color="black">:</font>Render<font color="black">(</font>Geometry geometry<font color="black">)</font>
<font color="black">{</font>
    <font color="blue">if</font> <font color="black">(</font><font color="black">!</font>geometry<font color="black">)</font>
        <font color="blue">return</font>;

    vector<font color="black">&#60;</font>Surface<font color="black">&#62;</font><font color="black">:</font><font color="black">:</font>iterator i<font color="black">=</font>geometry.resource<font color="black">-</font><font color="black">&#62;</font>surface.begin<font color="black">(</font><font color="black">)</font>;
    <font color="blue">if</font> <font color="black">(</font>geometry.resource<font color="black">-</font><font color="black">&#62;</font>vertexBuffer<font color="black">)</font>
        geometry.resource<font color="black">-</font><font color="black">&#62;</font>vertexBuffer.SetVertexStream<font color="black">(</font><font color="maroon">3</font><font color="black">)</font>;
    <font color="blue">if</font> <font color="black">(</font>geometry.resource<font color="black">-</font><font color="black">&#62;</font>diffuseUVBuffer<font color="black">)</font>
        geometry.resource<font color="black">-</font><font color="black">&#62;</font>diffuseUVBuffer.SetTexCoordStream<font color="black">(</font><font color="maroon">0</font><font color="black">)</font>;
    <font color="blue">else</font>
        Renderer<font color="black">:</font><font color="black">:</font>DisableTexCoordStream<font color="black">(</font><font color="maroon">0</font><font color="black">)</font>;
    <font color="blue">if</font> <font color="black">(</font>geometry.resource<font color="black">-</font><font color="black">&#62;</font>normalBuffer<font color="black">)</font>
        geometry.resource<font color="black">-</font><font color="black">&#62;</font>normalBuffer.SetNormalStream<font color="black">(</font><font color="black">)</font>;
    <font color="blue">else</font>
        Renderer<font color="black">:</font><font color="black">:</font>DisableNormalStream<font color="black">(</font><font color="black">)</font>;
    <font color="blue">for</font> <font color="black">(</font>;i<font color="black">!</font><font color="black">=</font>geometry.resource<font color="black">-</font><font color="black">&#62;</font>surface.end<font color="black">(</font><font color="black">)</font>;i<font color="black">+</font><font color="black">+</font><font color="black">)</font>
    <font color="black">{</font>
        Renderer<font color="black">:</font><font color="black">:</font>UseMaterial<font color="black">(</font>i<font color="black">-</font><font color="black">&#62;</font>material<font color="black">)</font>;
        <font color="blue">if</font> <font color="black">(</font>i<font color="black">-</font><font color="black">&#62;</font>indexBuffer<font color="black">)</font>
            i<font color="black">-</font><font color="black">&#62;</font>indexBuffer.SetIndexStream<font color="black">(</font><font color="black">)</font>;
        Renderer<font color="black">:</font><font color="black">:</font>RenderIndexStream<font color="black">(</font>TRIANGLES,i<font color="black">-</font><font color="black">&#62;</font>face.size<font color="black">(</font><font color="black">)</font><font color="black">*</font><font color="maroon">3</font><font color="black">)</font>;
    <font color="black">}</font>

<font color="black">}</font>
<font color="blue">void</font> Renderer<font color="black">:</font><font color="black">:</font>SaveModelViewMatrix<font color="black">(</font><font color="black">)</font>
<font color="black">{</font>
    glMatrixMode<font color="black">(</font>GL_MODELVIEW<font color="black">)</font>;
    glPushMatrix<font color="black">(</font><font color="black">)</font>;
<font color="black">}</font>
<font color="blue">void</font> Renderer<font color="black">:</font><font color="black">:</font>RestoreModelViewMatrix<font color="black">(</font><font color="black">)</font>
<font color="black">{</font>
    glMatrixMode<font color="black">(</font>GL_MODELVIEW<font color="black">)</font>;
    glPopMatrix<font color="black">(</font><font color="black">)</font>;
<font color="black">}</font>
<font color="blue">void</font> Renderer<font color="black">:</font><font color="black">:</font>SaveProjectionMatrix<font color="black">(</font><font color="black">)</font>
<font color="black">{</font>
    glMatrixMode<font color="black">(</font>GL_PROJECTION<font color="black">)</font>;
    glPushMatrix<font color="black">(</font><font color="black">)</font>;
<font color="black">}</font>
<font color="blue">void</font> Renderer<font color="black">:</font><font color="black">:</font>RestoreProjectionMatrix<font color="black">(</font><font color="black">)</font>
<font color="black">{</font>
    glMatrixMode<font color="black">(</font>GL_PROJECTION<font color="black">)</font>;
    glPopMatrix<font color="black">(</font><font color="black">)</font>;
<font color="black">}</font>

<font color="blue">void</font> Renderer<font color="black">:</font><font color="black">:</font>MultiplyModelViewMatrix<font color="black">(</font>mat4 <font color="black">&</font>mat<font color="black">)</font>
<font color="black">{</font>
    glMatrixMode<font color="black">(</font>GL_MODELVIEW<font color="black">)</font>;
    glMultMatrixf<font color="black">(</font>mat.m<font color="black">)</font>;
<font color="black">}</font>
<font color="blue">void</font> Renderer<font color="black">:</font><font color="black">:</font>UseTexture<font color="black">(</font>Texture tex,<font color="blue">unsigned</font> <font color="blue">int</font> unit<font color="black">)</font>
<font color="black">{</font>
    <font color="blue">if</font> <font color="black">(</font><font color="black">!</font>tex<font color="black">)</font>
        <font color="blue">return</font>;
    glActiveTexture<font color="black">(</font>GL_TEXTURE0<font color="black">+</font>unit<font color="black">)</font>;
    glBindTexture<font color="black">(</font>GL_TEXTURE_2D,tex.resource<font color="black">-</font><font color="black">&#62;</font>id<font color="black">)</font>;
<font color="black">}</font>
<font color="blue">void</font> Renderer<font color="black">:</font><font color="black">:</font>RenderText<font color="black">(</font>Font font,vec3 pos,vec4 color,<font color="blue">const</font> string <font color="black">&</font>str<font color="black">)</font>
<font color="black">{</font>   
    <font color="blue">if</font> <font color="black">(</font><font color="black">!</font>font<font color="black">)</font>
        <font color="blue">return</font>; 
    <font color="blue">static</font> vector<font color="black">&#60;</font>vec3<font color="black">&#62;</font> vBuffer;
    <font color="blue">static</font> vector<font color="black">&#60;</font>vec2<font color="black">&#62;</font> uvBuffer;
    vBuffer.resize<font color="black">(</font>str.size<font color="black">(</font><font color="black">)</font><font color="black">*</font><font color="maroon">4</font><font color="black">)</font>;
    uvBuffer.resize<font color="black">(</font>str.size<font color="black">(</font><font color="black">)</font><font color="black">*</font><font color="maroon">4</font><font color="black">)</font>;  
    <font color="blue">if</font> <font color="black">(</font>textShader.IsValid<font color="black">(</font><font color="black">)</font><font color="black">)</font>
    <font color="black">{</font>
        UseProgram<font color="black">(</font>textShader<font color="black">)</font>; 
        textShader.SetUniform<font color="black">(</font><font color="maroon">"tex0"</font>,<font color="maroon">0</font><font color="black">)</font>;
        textShader.SetUniform<font color="black">(</font><font color="maroon">"textColor"</font>,color<font color="black">)</font>;
    <font color="black">}</font>   
    <font color="blue">int</font> numQuads<font color="black">=</font><font color="maroon">0</font>;
    
    glDisable<font color="black">(</font>GL_DEPTH_TEST<font color="black">)</font>;
    glEnable<font color="black">(</font>GL_BLEND<font color="black">)</font>;
    glBlendFunc<font color="black">(</font>GL_SRC_ALPHA,GL_ONE_MINUS_SRC_ALPHA<font color="black">)</font>;   
    UseTexture<font color="black">(</font>font.resource<font color="black">-</font><font color="black">&#62;</font>page<font color="black">-</font><font color="black">&#62;</font>tex,<font color="maroon">0</font><font color="black">)</font>;     
    vec3 curPos<font color="black">=</font>pos;    
    FT_Long useKerning <font color="black">=</font> FT_HAS_KERNING<font color="black">(</font>font.resource<font color="black">-</font><font color="black">&#62;</font>fontImpl<font color="black">-</font><font color="black">&#62;</font>face<font color="black">)</font>;
    FT_UInt previous <font color="black">=</font> <font color="maroon">0</font>; 
    <font color="blue">for</font> <font color="black">(</font>string<font color="black">:</font><font color="black">:</font>const_iterator i<font color="black">=</font>str.begin<font color="black">(</font><font color="black">)</font>;i<font color="black">!</font><font color="black">=</font>str.end<font color="black">(</font><font color="black">)</font>;i<font color="black">+</font><font color="black">+</font><font color="black">)</font>
    <font color="black">{</font>
        <font color="blue">char</font> c<font color="black">=</font><font color="black">*</font>i;
        <font color="blue">if</font> <font color="black">(</font>c<font color="black">=</font><font color="black">=</font><font color="maroon">32</font><font color="black">)</font>
        <font color="black">{</font>
            curPos.x<font color="black">+</font><font color="black">=</font>font.resource<font color="black">-</font><font color="black">&#62;</font>glyph<font color="black">[</font>c<font color="black">]</font>.advance;
            <font color="blue">continue</font>;
        <font color="black">}</font>
        <font color="blue">if</font> <font color="black">(</font>font.resource<font color="black">-</font><font color="black">&#62;</font>glyph<font color="black">[</font>c<font color="black">]</font>.size<font color="black">!</font><font color="black">=</font>vec2<font color="black">(</font><font color="maroon">0</font>,<font color="maroon">0</font><font color="black">)</font><font color="black">)</font>
        <font color="black">{</font>

            FT_UInt glyphIndex <font color="black">=</font> FT_Get_Char_Index<font color="black">(</font> font.resource<font color="black">-</font><font color="black">&#62;</font>fontImpl<font color="black">-</font><font color="black">&#62;</font>face, c <font color="black">)</font>; 
            <font color="green">/* retrieve kerning distance and move pen position */</font>  
            <font color="blue">if</font> <font color="black">(</font> useKerning <font color="black">&</font><font color="black">&</font> previous <font color="black">&</font><font color="black">&</font> glyphIndex <font color="black">)</font> 
            <font color="black">{</font> 
                FT_Vector delta; 
                FT_Get_Kerning<font color="black">(</font> font.resource<font color="black">-</font><font color="black">&#62;</font>fontImpl<font color="black">-</font><font color="black">&#62;</font>face, previous, glyphIndex, FT_KERNING_DEFAULT, <font color="black">&</font>delta <font color="black">)</font>; 
                curPos.x <font color="black">+</font><font color="black">=</font> delta.x <font color="black">&#62;</font><font color="black">&#62;</font> <font color="maroon">6</font>; 
            <font color="black">}</font> 
            vBuffer<font color="black">[</font>numQuads<font color="black">*</font><font color="maroon">4</font><font color="black">+</font><font color="maroon">0</font><font color="black">]</font><font color="black">=</font>vec3<font color="black">(</font>font.resource<font color="black">-</font><font color="black">&#62;</font>glyph<font color="black">[</font>c<font color="black">]</font>.bitmapOffset.x<font color="black">+</font>curPos.x,font.resource<font color="black">-</font><font color="black">&#62;</font>glyph<font color="black">[</font>c<font color="black">]</font>.bitmapOffset.y<font color="black">+</font>curPos.y,curPos.z<font color="black">)</font>;
            vBuffer<font color="black">[</font>numQuads<font color="black">*</font><font color="maroon">4</font><font color="black">+</font><font color="maroon">1</font><font color="black">]</font><font color="black">=</font>vec3<font color="black">(</font>font.resource<font color="black">-</font><font color="black">&#62;</font>glyph<font color="black">[</font>c<font color="black">]</font>.bitmapOffset.x<font color="black">+</font>curPos.x,font.resource<font color="black">-</font><font color="black">&#62;</font>glyph<font color="black">[</font>c<font color="black">]</font>.bitmapOffset.y<font color="black">+</font>curPos.y<font color="black">+</font>font.resource<font color="black">-</font><font color="black">&#62;</font>glyph<font color="black">[</font>c<font color="black">]</font>.size.y,curPos.z<font color="black">)</font>;
            vBuffer<font color="black">[</font>numQuads<font color="black">*</font><font color="maroon">4</font><font color="black">+</font><font color="maroon">2</font><font color="black">]</font><font color="black">=</font>vec3<font color="black">(</font>font.resource<font color="black">-</font><font color="black">&#62;</font>glyph<font color="black">[</font>c<font color="black">]</font>.bitmapOffset.x<font color="black">+</font>curPos.x<font color="black">+</font>font.resource<font color="black">-</font><font color="black">&#62;</font>glyph<font color="black">[</font>c<font color="black">]</font>.size.x,font.resource<font color="black">-</font><font color="black">&#62;</font>glyph<font color="black">[</font>c<font color="black">]</font>.bitmapOffset.y<font color="black">+</font>curPos.y<font color="black">+</font>font.resource<font color="black">-</font><font color="black">&#62;</font>glyph<font color="black">[</font>c<font color="black">]</font>.size.y,curPos.z<font color="black">)</font>;
            vBuffer<font color="black">[</font>numQuads<font color="black">*</font><font color="maroon">4</font><font color="black">+</font><font color="maroon">3</font><font color="black">]</font><font color="black">=</font>vec3<font color="black">(</font>font.resource<font color="black">-</font><font color="black">&#62;</font>glyph<font color="black">[</font>c<font color="black">]</font>.bitmapOffset.x<font color="black">+</font>curPos.x<font color="black">+</font>font.resource<font color="black">-</font><font color="black">&#62;</font>glyph<font color="black">[</font>c<font color="black">]</font>.size.x,font.resource<font color="black">-</font><font color="black">&#62;</font>glyph<font color="black">[</font>c<font color="black">]</font>.bitmapOffset.y<font color="black">+</font>curPos.y,curPos.z<font color="black">)</font>;
            uvBuffer<font color="black">[</font>numQuads<font color="black">*</font><font color="maroon">4</font><font color="black">+</font><font color="maroon">0</font><font color="black">]</font><font color="black">=</font>vec2<font color="black">(</font>font.resource<font color="black">-</font><font color="black">&#62;</font>glyph<font color="black">[</font>c<font color="black">]</font>.uv.x,font.resource<font color="black">-</font><font color="black">&#62;</font>glyph<font color="black">[</font>c<font color="black">]</font>.uv.y<font color="black">)</font>;
            uvBuffer<font color="black">[</font>numQuads<font color="black">*</font><font color="maroon">4</font><font color="black">+</font><font color="maroon">1</font><font color="black">]</font><font color="black">=</font>vec2<font color="black">(</font>font.resource<font color="black">-</font><font color="black">&#62;</font>glyph<font color="black">[</font>c<font color="black">]</font>.uv.x,font.resource<font color="black">-</font><font color="black">&#62;</font>glyph<font color="black">[</font>c<font color="black">]</font>.uv.y<font color="black">+</font>font.resource<font color="black">-</font><font color="black">&#62;</font>glyph<font color="black">[</font>c<font color="black">]</font>.size.y<font color="black">/</font><font color="maroon">512</font>.0f<font color="black">)</font>;
            uvBuffer<font color="black">[</font>numQuads<font color="black">*</font><font color="maroon">4</font><font color="black">+</font><font color="maroon">2</font><font color="black">]</font><font color="black">=</font>vec2<font color="black">(</font>font.resource<font color="black">-</font><font color="black">&#62;</font>glyph<font color="black">[</font>c<font color="black">]</font>.uv.x<font color="black">+</font>font.resource<font color="black">-</font><font color="black">&#62;</font>glyph<font color="black">[</font>c<font color="black">]</font>.size.x<font color="black">/</font><font color="maroon">512</font>.0f,font.resource<font color="black">-</font><font color="black">&#62;</font>glyph<font color="black">[</font>c<font color="black">]</font>.uv.y<font color="black">+</font>font.resource<font color="black">-</font><font color="black">&#62;</font>glyph<font color="black">[</font>c<font color="black">]</font>.size.y<font color="black">/</font><font color="maroon">512</font>.0f<font color="black">)</font>;
            uvBuffer<font color="black">[</font>numQuads<font color="black">*</font><font color="maroon">4</font><font color="black">+</font><font color="maroon">3</font><font color="black">]</font><font color="black">=</font>vec2<font color="black">(</font>font.resource<font color="black">-</font><font color="black">&#62;</font>glyph<font color="black">[</font>c<font color="black">]</font>.uv.x<font color="black">+</font>font.resource<font color="black">-</font><font color="black">&#62;</font>glyph<font color="black">[</font>c<font color="black">]</font>.size.x<font color="black">/</font><font color="maroon">512</font>.0f,font.resource<font color="black">-</font><font color="black">&#62;</font>glyph<font color="black">[</font>c<font color="black">]</font>.uv.y<font color="black">)</font>;
            numQuads<font color="black">+</font><font color="black">+</font>;
            curPos.x<font color="black">+</font><font color="black">=</font>font.resource<font color="black">-</font><font color="black">&#62;</font>glyph<font color="black">[</font>c<font color="black">]</font>.advance;
            previous<font color="black">=</font>glyphIndex;
        <font color="black">}</font>       
    <font color="black">}</font>   
    textVertexBuffer.LoadData<font color="black">(</font><font color="black">&</font>vBuffer<font color="black">[</font><font color="maroon">0</font><font color="black">]</font>,numQuads<font color="black">*</font><font color="maroon">4</font><font color="black">*</font><font color="blue">sizeof</font><font color="black">(</font>vec3<font color="black">)</font>,STREAM<font color="black">)</font>;
    textUvBuffer.LoadData<font color="black">(</font><font color="black">&</font>uvBuffer<font color="black">[</font><font color="maroon">0</font><font color="black">]</font>,numQuads<font color="black">*</font><font color="maroon">4</font><font color="black">*</font><font color="blue">sizeof</font><font color="black">(</font>vec2<font color="black">)</font>,STREAM<font color="black">)</font>;
    textUvBuffer.SetTexCoordStream<font color="black">(</font><font color="maroon">0</font><font color="black">)</font>;
    textVertexBuffer.SetVertexStream<font color="black">(</font><font color="maroon">3</font><font color="black">)</font>;
    RenderStream<font color="black">(</font>QUADS,numQuads<font color="black">*</font><font color="maroon">4</font><font color="black">)</font>;
    glDisable<font color="black">(</font>GL_BLEND<font color="black">)</font>;    
    glEnable<font color="black">(</font>GL_DEPTH_TEST<font color="black">)</font>;        
<font color="black">}</font>
<font color="blue">void</font> Renderer<font color="black">:</font><font color="black">:</font>RenderIndexStream<font color="black">(</font>RenderMode mode,<font color="blue">unsigned</font> <font color="blue">int</font> count<font color="black">)</font>
<font color="black">{</font>
    GLenum glmode;
    <font color="blue">switch</font> <font color="black">(</font>mode<font color="black">)</font>
    <font color="black">{</font>
    <font color="blue">case</font> POINTS<font color="black">:</font>
        glmode<font color="black">=</font>GL_POINTS;
        <font color="blue">break</font>;
    <font color="blue">case</font> LINES<font color="black">:</font>
        glmode<font color="black">=</font>GL_LINES;
        <font color="blue">break</font>;
    <font color="blue">case</font> TRIANGLES<font color="black">:</font>
        glmode<font color="black">=</font>GL_TRIANGLES;
        <font color="blue">break</font>;
    <font color="blue">case</font> TRIANGLE_STRIP<font color="black">:</font>
        glmode<font color="black">=</font>GL_TRIANGLE_STRIP;
        <font color="blue">break</font>;
    <font color="blue">case</font> QUADS<font color="black">:</font>
        glmode<font color="black">=</font>GL_QUADS;
        <font color="blue">break</font>;
    <font color="blue">case</font> LINE_LOOP<font color="black">:</font>
        glmode<font color="black">=</font>GL_LINE_LOOP;
        <font color="blue">break</font>;
    <font color="blue">case</font> TRIANGLE_FAN<font color="black">:</font>
        glmode<font color="black">=</font>GL_TRIANGLE_FAN;
        <font color="blue">break</font>;
    <font color="black">}</font>   
    glDrawElements<font color="black">(</font>glmode,count,GL_UNSIGNED_INT,<font color="maroon">0</font><font color="black">)</font>;
<font color="black">}</font>
<font color="blue">void</font> Renderer<font color="black">:</font><font color="black">:</font>RenderStream<font color="black">(</font>RenderMode mode,<font color="blue">unsigned</font> <font color="blue">int</font> count<font color="black">)</font>
<font color="black">{</font>
    GLenum glmode;
    <font color="blue">switch</font> <font color="black">(</font>mode<font color="black">)</font>
    <font color="black">{</font>
    <font color="blue">case</font> POINTS<font color="black">:</font>
        glmode<font color="black">=</font>GL_POINTS;
        <font color="blue">break</font>;
    <font color="blue">case</font> LINES<font color="black">:</font>
        glmode<font color="black">=</font>GL_LINES;
        <font color="blue">break</font>;
    <font color="blue">case</font> TRIANGLES<font color="black">:</font>
        glmode<font color="black">=</font>GL_TRIANGLES;
        <font color="blue">break</font>;
    <font color="blue">case</font> TRIANGLE_STRIP<font color="black">:</font>
        glmode<font color="black">=</font>GL_TRIANGLE_STRIP;
        <font color="blue">break</font>;
    <font color="blue">case</font> QUADS<font color="black">:</font>
        glmode<font color="black">=</font>GL_QUADS;
        <font color="blue">break</font>;
    <font color="blue">case</font> LINE_LOOP<font color="black">:</font>
        glmode<font color="black">=</font>GL_LINE_LOOP;
        <font color="blue">break</font>;
    <font color="blue">case</font> TRIANGLE_FAN<font color="black">:</font>
        glmode<font color="black">=</font>GL_TRIANGLE_FAN;
        <font color="blue">break</font>;
    <font color="black">}</font>   
    glDrawArrays<font color="black">(</font>glmode,<font color="maroon">0</font>,count<font color="black">)</font>;
<font color="black">}</font>
<font color="blue">void</font> Renderer<font color="black">:</font><font color="black">:</font>UseProgram<font color="black">(</font>Program program<font color="black">)</font>
<font color="black">{</font>
    <font color="blue">if</font> <font color="black">(</font><font color="black">(</font>globalProgram<font color="black">)</font> <font color="black">&</font><font color="black">&</font> <font color="black">(</font>globalProgram.IsValid<font color="black">(</font><font color="black">)</font><font color="black">)</font><font color="black">)</font>
        <font color="blue">return</font>;
    <font color="blue">if</font> <font color="black">(</font>program<font color="black">)</font>
        glUseProgram<font color="black">(</font>program.GetId<font color="black">(</font><font color="black">)</font><font color="black">)</font>;  
<font color="black">}</font>
<font color="blue">void</font> Renderer<font color="black">:</font><font color="black">:</font>SetGlobalProgram<font color="black">(</font>Program program<font color="black">)</font>
<font color="black">{</font>
    globalProgram<font color="black">=</font>program;
    <font color="blue">if</font> <font color="black">(</font>program<font color="black">)</font>
        glUseProgram<font color="black">(</font>program.GetId<font color="black">(</font><font color="black">)</font><font color="black">)</font>;
<font color="black">}</font>
<font color="blue">void</font> Renderer<font color="black">:</font><font color="black">:</font>UseMaterial<font color="black">(</font>Material material<font color="black">)</font>
<font color="black">{</font>
    <font color="blue">if</font> <font color="black">(</font><font color="black">!</font>material<font color="black">)</font>
        <font color="blue">return</font>;
    
    vec4 ambientColor<font color="black">=</font>material.GetAmbientColor<font color="black">(</font><font color="black">)</font>;
    vec4 diffuseColor<font color="black">=</font>material.GetDiffuseColor<font color="black">(</font><font color="black">)</font>;
    vec4 specularColor<font color="black">=</font>material.GetSpecularColor<font color="black">(</font><font color="black">)</font>;
    glMaterialfv<font color="black">(</font>GL_FRONT,GL_AMBIENT,<font color="black">&</font>ambientColor.x<font color="black">)</font>;
    glMaterialfv<font color="black">(</font>GL_FRONT,GL_DIFFUSE,<font color="black">&</font>diffuseColor.x<font color="black">)</font>;
    glMaterialfv<font color="black">(</font>GL_FRONT,GL_SPECULAR,<font color="black">&</font>specularColor.x<font color="black">)</font>;
    glMaterialf<font color="black">(</font>GL_FRONT,GL_SHININESS,material.GetShininess<font color="black">(</font><font color="black">)</font><font color="black">)</font>;
    <font color="blue">if</font> <font color="black">(</font><font color="black">(</font>material.GetDiffuseTexture<font color="black">(</font><font color="black">)</font><font color="black">)</font> <font color="black">&</font><font color="black">&</font> <font color="black">(</font>material.GetDiffuseTexture<font color="black">(</font><font color="black">)</font>.IsValid<font color="black">(</font><font color="black">)</font><font color="black">)</font><font color="black">)</font>
    <font color="black">{</font>
        UseTexture<font color="black">(</font>material.GetDiffuseTexture<font color="black">(</font><font color="black">)</font>,<font color="maroon">0</font><font color="black">)</font>;
    <font color="black">}</font>
    <font color="blue">if</font> <font color="black">(</font><font color="black">(</font>material.GetNormalTexture<font color="black">(</font><font color="black">)</font><font color="black">)</font> <font color="black">&</font><font color="black">&</font> <font color="black">(</font>material.GetNormalTexture<font color="black">(</font><font color="black">)</font>.IsValid<font color="black">(</font><font color="black">)</font><font color="black">)</font><font color="black">)</font>
    <font color="black">{</font>
        UseTexture<font color="black">(</font>material.GetNormalTexture<font color="black">(</font><font color="black">)</font>,<font color="maroon">1</font><font color="black">)</font>;
    <font color="black">}</font>
<font color="black">}</font>
<font color="blue">void</font> Renderer<font color="black">:</font><font color="black">:</font>SetPerspectiveProjection<font color="black">(</font><font color="blue">float</font> fov,<font color="blue">float</font> zNear,<font color="blue">float</font> zFar<font color="black">)</font>
<font color="black">{</font>
    GLint viewport<font color="black">[</font><font color="maroon">4</font><font color="black">]</font>;
    glGetIntegerv<font color="black">(</font>GL_VIEWPORT,viewport<font color="black">)</font>;
    mat4 p;
    p.GeneratePerspective<font color="black">(</font>fov,<font color="black">(</font><font color="blue">float</font><font color="black">)</font>viewport<font color="black">[</font><font color="maroon">2</font><font color="black">]</font><font color="black">/</font><font color="black">(</font><font color="blue">float</font><font color="black">)</font>viewport<font color="black">[</font><font color="maroon">3</font><font color="black">]</font>,zNear,zFar<font color="black">)</font>;
    SetProjectionMatrix<font color="black">(</font>p<font color="black">)</font>;
<font color="black">}</font>
<font color="blue">void</font> Renderer<font color="black">:</font><font color="black">:</font>SetOrthographicProjection<font color="black">(</font><font color="black">)</font>
<font color="black">{</font>
    GLint viewport<font color="black">[</font><font color="maroon">4</font><font color="black">]</font>;
    glGetIntegerv<font color="black">(</font>GL_VIEWPORT,viewport<font color="black">)</font>;
    mat4 p;
    p.GenerateOrthographic<font color="black">(</font><font color="maroon">0</font>,<font color="black">(</font><font color="blue">float</font><font color="black">)</font>viewport<font color="black">[</font><font color="maroon">2</font><font color="black">]</font>,<font color="black">(</font><font color="blue">float</font><font color="black">)</font>viewport<font color="black">[</font><font color="maroon">3</font><font color="black">]</font>,<font color="maroon">0</font>,<font color="maroon">0</font>,<font color="maroon">1</font><font color="black">)</font>;
    SetProjectionMatrix<font color="black">(</font>p<font color="black">)</font>;
<font color="black">}</font>
<font color="blue">void</font> InitializeRenderer<font color="black">(</font><font color="black">)</font>
<font color="black">{</font>   
    Shader vShader;
    Shader fShader;
    
    textVertexBuffer.Create<font color="black">(</font><font color="black">)</font>;
    textUvBuffer.Create<font color="black">(</font><font color="black">)</font>;
    vShader.Create<font color="black">(</font>VERTEX_SHADER,<font color="maroon">"void main() \
                                  { \
                                  gl_TexCoord[0]=gl_MultiTexCoord0; \
                                  gl_Position = ftransform(); \
                                  } "</font><font color="black">)</font>;

    fShader.Create<font color="black">(</font>FRAGMENT_SHADER,<font color="maroon">"uniform vec4 textColor; \
                                    uniform sampler2D tex0; \
                                    void main() \
                                    { \
                                    float alpha=texture2D(tex0,gl_TexCoord[0].st).a; \
                                    gl_FragColor = vec4(textColor.r,textColor.g,textColor.b,textColor.a*alpha);  \
                                    } "</font><font color="black">)</font>;
    textShader.Create<font color="black">(</font>vShader,fShader<font color="black">)</font>;

    Technique technique;
    technique.Create<font color="black">(</font><font color="black">)</font>;
    <font color="blue">if</font> <font color="black">(</font><font color="black">!</font>technique.LoadShader<font color="black">(</font><font color="maroon">"default.vert"</font><font color="black">)</font> <font color="black">&</font><font color="black">&</font> <font color="black">!</font>technique.LoadShader<font color="black">(</font><font color="maroon">"Shaders/default.vert"</font><font color="black">)</font> <font color="black">&</font><font color="black">&</font> <font color="black">!</font>technique.LoadShader<font color="black">(</font><font color="maroon">"../Assets/Shaders/default.vert"</font><font color="black">)</font> <font color="black">&</font><font color="black">&</font> <font color="black">!</font>technique.LoadShader<font color="black">(</font><font color="maroon">"./Assets/Shaders/default.vert"</font><font color="black">)</font><font color="black">)</font>
        Logger<font color="black">:</font><font color="black">:</font>Write<font color="black">(</font>Logger<font color="black">:</font><font color="black">:</font>LOG_WARNING, <font color="maroon">"Could not load default technique's vertex shader"</font><font color="black">)</font>;
    <font color="blue">else</font>
    <font color="black">{</font>
        <font color="blue">if</font> <font color="black">(</font><font color="black">!</font>technique.LoadShader<font color="black">(</font><font color="maroon">"default.frag"</font><font color="black">)</font> <font color="black">&</font><font color="black">&</font> <font color="black">!</font>technique.LoadShader<font color="black">(</font><font color="maroon">"Shaders/default.frag"</font><font color="black">)</font> <font color="black">&</font><font color="black">&</font> <font color="black">!</font>technique.LoadShader<font color="black">(</font><font color="maroon">"../Assets/Shaders/default.frag"</font><font color="black">)</font> <font color="black">&</font><font color="black">&</font> <font color="black">!</font>technique.LoadShader<font color="black">(</font><font color="maroon">"./Assets/Shaders/default.frag"</font><font color="black">)</font><font color="black">)</font>
            Logger<font color="black">:</font><font color="black">:</font>Write<font color="black">(</font>Logger<font color="black">:</font><font color="black">:</font>LOG_WARNING, <font color="maroon">"Could not load default technique's fragment shader"</font><font color="black">)</font>;
        <font color="blue">else</font>
            Renderer<font color="black">:</font><font color="black">:</font>AddTechnique<font color="black">(</font><font color="maroon">"default"</font>,technique<font color="black">)</font>;
    <font color="black">}</font>
<font color="black">}</font>
<font color="blue">void</font> Renderer<font color="black">:</font><font color="black">:</font>SetTextureManager<font color="black">(</font>TextureManager <font color="black">&</font>textureManager<font color="black">)</font>
<font color="black">{</font>
    currentTextureManager<font color="black">=</font><font color="black">&</font>textureManager;
<font color="black">}</font>
TextureManager <font color="black">&</font>Renderer<font color="black">:</font><font color="black">:</font>GetTextureManager<font color="black">(</font><font color="black">)</font>
<font color="black">{</font>
    <font color="blue">return</font> <font color="black">*</font>currentTextureManager;
<font color="black">}</font>
<font color="blue">void</font> Renderer<font color="black">:</font><font color="black">:</font>SetShaderManager<font color="black">(</font>ShaderManager <font color="black">&</font>shaderManager<font color="black">)</font>
<font color="black">{</font>
    currentShaderManager<font color="black">=</font><font color="black">&</font>shaderManager;
<font color="black">}</font>
ShaderManager <font color="black">&</font>Renderer<font color="black">:</font><font color="black">:</font>GetShaderManager<font color="black">(</font><font color="black">)</font>
<font color="black">{</font>
    <font color="blue">return</font> <font color="black">*</font>currentShaderManager;
<font color="black">}</font>
<font color="blue">void</font> Renderer<font color="black">:</font><font color="black">:</font>SetFontManager<font color="black">(</font>FontManager <font color="black">&</font>fontManager<font color="black">)</font>
<font color="black">{</font>
    currentFontManager<font color="black">=</font><font color="black">&</font>fontManager;
<font color="black">}</font>
FontManager <font color="black">&</font>Renderer<font color="black">:</font><font color="black">:</font>GetFontManager<font color="black">(</font><font color="black">)</font>
<font color="black">{</font>
    <font color="blue">return</font> <font color="black">*</font>currentFontManager;
<font color="black">}</font>
<font color="blue">void</font> DestroyRenderer<font color="black">(</font><font color="black">)</font>
<font color="black">{</font>
    textVertexBuffer.Destroy<font color="black">(</font><font color="black">)</font>;
    textUvBuffer.Destroy<font color="black">(</font><font color="black">)</font>;
    textShader<font color="black">=</font>Program<font color="black">(</font><font color="black">)</font>;
<font color="black">}</font>
<font color="blue">void</font> Renderer<font color="black">:</font><font color="black">:</font>UseFrameBuffer<font color="black">(</font>FrameBuffer frameBuffer<font color="black">)</font>
<font color="black">{</font>
    glBindFramebufferEXT<font color="black">(</font>GL_FRAMEBUFFER_EXT,frameBuffer.resource<font color="black">-</font><font color="black">&#62;</font>id<font color="black">)</font>;  
    glViewport<font color="black">(</font><font color="maroon">0</font>,<font color="maroon">0</font>,frameBuffer.resource<font color="black">-</font><font color="black">&#62;</font>width,frameBuffer.resource<font color="black">-</font><font color="black">&#62;</font>height<font color="black">)</font>;   
    <font color="blue">bool</font> found<font color="black">=</font><font color="blue">false</font>;
    <font color="blue">for</font> <font color="black">(</font><font color="blue">int</font> i<font color="black">=</font><font color="maroon">0</font>;<font color="black">(</font>i<font color="black">&#60;</font>MAX_TEXTURES<font color="black">)</font> <font color="black">&</font><font color="black">&</font> <font color="black">(</font><font color="black">!</font>found<font color="black">)</font>;i<font color="black">+</font><font color="black">+</font><font color="black">)</font>
        <font color="blue">if</font> <font color="black">(</font><font color="black">(</font>frameBuffer.resource<font color="black">-</font><font color="black">&#62;</font>texture<font color="black">[</font>i<font color="black">]</font><font color="black">)</font> <font color="black">&</font><font color="black">&</font> <font color="black">(</font>frameBuffer.resource<font color="black">-</font><font color="black">&#62;</font>texture<font color="black">[</font>i<font color="black">]</font>.IsValid<font color="black">(</font><font color="black">)</font><font color="black">)</font><font color="black">)</font>
            found<font color="black">=</font><font color="blue">true</font>;
    <font color="blue">if</font> <font color="black">(</font>found<font color="black">)</font>
        glDrawBuffer<font color="black">(</font>GL_BACK<font color="black">)</font>;
    <font color="blue">else</font>
        glDrawBuffer<font color="black">(</font>GL_NONE<font color="black">)</font>;
<font color="black">}</font>
<font color="blue">void</font> Renderer<font color="black">:</font><font color="black">:</font>RestoreFrameBuffer<font color="black">(</font><font color="black">)</font>
<font color="black">{</font>
    glBindFramebufferEXT<font color="black">(</font>GL_FRAMEBUFFER_EXT,<font color="maroon">0</font><font color="black">)</font>; 
<font color="black">}</font>
<font color="blue">void</font> Renderer<font color="black">:</font><font color="black">:</font>SetViewport<font color="black">(</font><font color="blue">int</font> left,<font color="blue">int</font> right,<font color="blue">int</font> width,<font color="blue">int</font> height<font color="black">)</font>
<font color="black">{</font>
    glViewport<font color="black">(</font>left,right,width,height<font color="black">)</font>;
<font color="black">}</font>
mat4 Renderer<font color="black">:</font><font color="black">:</font>GetModelViewMatrix<font color="black">(</font><font color="black">)</font>
<font color="black">{</font>
    mat4 ret;
    glGetFloatv<font color="black">(</font>GL_MODELVIEW_MATRIX,ret.m<font color="black">)</font>;
    <font color="blue">return</font> ret;
<font color="black">}</font>
mat4 Renderer<font color="black">:</font><font color="black">:</font>GetProjectionMatrix<font color="black">(</font><font color="black">)</font>
<font color="black">{</font>
    mat4 ret;
    glGetFloatv<font color="black">(</font>GL_PROJECTION_MATRIX,ret.m<font color="black">)</font>;
    <font color="blue">return</font> ret;

<font color="black">}</font>
<font color="blue">void</font> Renderer<font color="black">:</font><font color="black">:</font>DisableTexCoordStream<font color="black">(</font><font color="blue">unsigned</font> <font color="blue">int</font> unit<font color="black">)</font>
<font color="black">{</font>
    glClientActiveTexture<font color="black">(</font>GL_TEXTURE0<font color="black">+</font>unit<font color="black">)</font>;
    glDisableClientState<font color="black">(</font>GL_TEXTURE_COORD_ARRAY<font color="black">)</font>;
<font color="black">}</font>
<font color="blue">void</font> Renderer<font color="black">:</font><font color="black">:</font>DisableNormalStream<font color="black">(</font><font color="black">)</font>
<font color="black">{</font>
    glDisableClientState<font color="black">(</font>GL_NORMAL_ARRAY<font color="black">)</font>;
<font color="black">}</font>
<font color="blue">void</font> RenderNode<font color="black">(</font>Node node,vector<font color="black">&#60;</font>pair<font color="black">&#60;</font>mat4,pair<font color="black">&#60;</font>Node,Geometry<font color="black">&#62;</font><font color="black">&#62;</font><font color="black">&#62;</font> <font color="black">&</font>renderingQueue,vector<font color="black">&#60;</font>pair<font color="black">&#60;</font>mat4,Light<font color="black">&#62;</font><font color="black">&#62;</font> <font color="black">&</font>activeLights<font color="black">)</font>
<font color="black">{</font>
    <font color="blue">if</font> <font color="black">(</font>node.GetParent<font color="black">(</font><font color="black">)</font><font color="black">)</font>
        node.SetWorldTransformation<font color="black">(</font>node.GetParent<font color="black">(</font><font color="black">)</font>.GetWorldTransformation<font color="black">(</font><font color="black">)</font><font color="black">*</font>node.GetLocalTransformation<font color="black">(</font><font color="black">)</font><font color="black">)</font>;
    <font color="blue">else</font>
        node.SetWorldTransformation<font color="black">(</font>node.GetLocalTransformation<font color="black">(</font><font color="black">)</font><font color="black">)</font>;
    <font color="blue">for</font> <font color="black">(</font>vector<font color="black">&#60;</font>Geometry<font color="black">&#62;</font><font color="black">:</font><font color="black">:</font>iterator i<font color="black">=</font>node.GetGeometries<font color="black">(</font><font color="black">)</font>.begin<font color="black">(</font><font color="black">)</font>;i<font color="black">!</font><font color="black">=</font>node.GetGeometries<font color="black">(</font><font color="black">)</font>.end<font color="black">(</font><font color="black">)</font>;i<font color="black">+</font><font color="black">+</font><font color="black">)</font>
    <font color="black">{</font>       
        renderingQueue.push_back<font color="black">(</font>make_pair<font color="black">(</font>node.GetWorldTransformation<font color="black">(</font><font color="black">)</font>,make_pair<font color="black">(</font>node,<font color="black">*</font>i<font color="black">)</font><font color="black">)</font><font color="black">)</font>;
    <font color="black">}</font>
    <font color="blue">for</font> <font color="black">(</font>vector<font color="black">&#60;</font>Light<font color="black">&#62;</font><font color="black">:</font><font color="black">:</font>iterator i<font color="black">=</font>node.GetLights<font color="black">(</font><font color="black">)</font>.begin<font color="black">(</font><font color="black">)</font>;i<font color="black">!</font><font color="black">=</font>node.GetLights<font color="black">(</font><font color="black">)</font>.end<font color="black">(</font><font color="black">)</font>;i<font color="black">+</font><font color="black">+</font><font color="black">)</font>
    <font color="black">{</font>       
        activeLights.push_back<font color="black">(</font>make_pair<font color="black">(</font>node.GetWorldTransformation<font color="black">(</font><font color="black">)</font>,<font color="black">*</font>i<font color="black">)</font><font color="black">)</font>;
    <font color="black">}</font>
    <font color="blue">for</font> <font color="black">(</font>vector<font color="black">&#60;</font>Node<font color="black">&#62;</font><font color="black">:</font><font color="black">:</font>iterator i<font color="black">=</font>node.GetChildren<font color="black">(</font><font color="black">)</font>.begin<font color="black">(</font><font color="black">)</font>;i<font color="black">!</font><font color="black">=</font>node.GetChildren<font color="black">(</font><font color="black">)</font>.end<font color="black">(</font><font color="black">)</font>;i<font color="black">+</font><font color="black">+</font><font color="black">)</font>
        RenderNode<font color="black">(</font><font color="black">*</font>i,renderingQueue,activeLights<font color="black">)</font>;
<font color="black">}</font>
<font color="blue">void</font> FIRECUBE_API Renderer<font color="black">:</font><font color="black">:</font>Render<font color="black">(</font><font color="blue">const</font> RenderQueue <font color="black">&</font>queue<font color="black">)</font>
<font color="black">{</font>

<font color="black">}</font>
<font color="blue">void</font> FIRECUBE_API Renderer<font color="black">:</font><font color="black">:</font>Render<font color="black">(</font>Node node<font color="black">)</font>
<font color="black">{</font>
    vector<font color="black">&#60;</font>pair<font color="black">&#60;</font>mat4,pair<font color="black">&#60;</font>Node,Geometry<font color="black">&#62;</font><font color="black">&#62;</font><font color="black">&#62;</font> renderingQueue;
    vector<font color="black">&#60;</font>pair<font color="black">&#60;</font>mat4,Light<font color="black">&#62;</font><font color="black">&#62;</font> activeLights;  
    <font color="blue">bool</font> firstPass<font color="black">=</font><font color="blue">true</font>;
    <font color="green">//root-&#62;Render();</font>
    RenderNode<font color="black">(</font>node,renderingQueue,activeLights<font color="black">)</font>;
    vector<font color="black">&#60;</font>pair<font color="black">&#60;</font>mat4,Light<font color="black">&#62;</font><font color="black">&#62;</font><font color="black">:</font><font color="black">:</font>iterator i;
    vector<font color="black">&#60;</font>pair<font color="black">&#60;</font>mat4,pair<font color="black">&#60;</font>Node,Geometry<font color="black">&#62;</font><font color="black">&#62;</font><font color="black">&#62;</font><font color="black">:</font><font color="black">:</font>iterator j;
    glEnable<font color="black">(</font>GL_BLEND<font color="black">)</font>;

    <font color="blue">for</font> <font color="black">(</font>i<font color="black">=</font>activeLights.begin<font color="black">(</font><font color="black">)</font>;i<font color="black">!</font><font color="black">=</font>activeLights.end<font color="black">(</font><font color="black">)</font>;i<font color="black">+</font><font color="black">+</font><font color="black">)</font>
    <font color="black">{</font>               
        <font color="blue">if</font> <font color="black">(</font>firstPass<font color="black">)</font>
        <font color="black">{</font>
            glDepthFunc<font color="black">(</font>GL_LESS<font color="black">)</font>;
            glBlendFunc<font color="black">(</font>GL_ONE,GL_ZERO<font color="black">)</font>;
            glDepthMask<font color="black">(</font><font color="blue">true</font><font color="black">)</font>;
        <font color="black">}</font>
        <font color="blue">else</font>
        <font color="black">{</font>
            glDepthFunc<font color="black">(</font>GL_LEQUAL<font color="black">)</font>;
            glBlendFunc<font color="black">(</font>GL_ONE,GL_ONE<font color="black">)</font>;
            glDepthMask<font color="black">(</font><font color="blue">false</font><font color="black">)</font>;
        <font color="black">}</font>       
        <font color="blue">for</font> <font color="black">(</font>j<font color="black">=</font>renderingQueue.begin<font color="black">(</font><font color="black">)</font>;j<font color="black">!</font><font color="black">=</font>renderingQueue.end<font color="black">(</font><font color="black">)</font>;j<font color="black">+</font><font color="black">+</font><font color="black">)</font>
        <font color="black">{</font>
            Geometry geometry<font color="black">=</font>j<font color="black">-</font><font color="black">&#62;</font>second.second;
            Node node<font color="black">=</font>j<font color="black">-</font><font color="black">&#62;</font>second.first;
            mat4 transformation<font color="black">=</font>j<font color="black">-</font><font color="black">&#62;</font>first;               
            <font color="blue">if</font> <font color="black">(</font>node.GetRenderParameters<font color="black">(</font><font color="black">)</font>.lighting<font color="black">)</font>
            <font color="black">{</font>                           
                Renderer<font color="black">:</font><font color="black">:</font>SaveModelViewMatrix<font color="black">(</font><font color="black">)</font>;
                Renderer<font color="black">:</font><font color="black">:</font>MultiplyModelViewMatrix<font color="black">(</font>transformation<font color="black">)</font>;
                <font color="green">//Renderer::Render(geometry);</font>

                vector<font color="black">&#60;</font>Surface<font color="black">&#62;</font><font color="black">:</font><font color="black">:</font>iterator k<font color="black">=</font>geometry.resource<font color="black">-</font><font color="black">&#62;</font>surface.begin<font color="black">(</font><font color="black">)</font>;
                <font color="blue">if</font> <font color="black">(</font>geometry.resource<font color="black">-</font><font color="black">&#62;</font>vertexBuffer<font color="black">)</font>
                    geometry.resource<font color="black">-</font><font color="black">&#62;</font>vertexBuffer.SetVertexStream<font color="black">(</font><font color="maroon">3</font><font color="black">)</font>;
                <font color="blue">if</font> <font color="black">(</font>geometry.resource<font color="black">-</font><font color="black">&#62;</font>diffuseUVBuffer<font color="black">)</font>
                    geometry.resource<font color="black">-</font><font color="black">&#62;</font>diffuseUVBuffer.SetTexCoordStream<font color="black">(</font><font color="maroon">0</font><font color="black">)</font>;
                <font color="blue">else</font>
                    Renderer<font color="black">:</font><font color="black">:</font>DisableTexCoordStream<font color="black">(</font><font color="maroon">0</font><font color="black">)</font>;
                <font color="blue">if</font> <font color="black">(</font>geometry.resource<font color="black">-</font><font color="black">&#62;</font>normalBuffer<font color="black">)</font>
                    geometry.resource<font color="black">-</font><font color="black">&#62;</font>normalBuffer.SetNormalStream<font color="black">(</font><font color="black">)</font>;
                <font color="blue">else</font>
                    Renderer<font color="black">:</font><font color="black">:</font>DisableNormalStream<font color="black">(</font><font color="black">)</font>;
                <font color="blue">for</font> <font color="black">(</font>;k<font color="black">!</font><font color="black">=</font>geometry.resource<font color="black">-</font><font color="black">&#62;</font>surface.end<font color="black">(</font><font color="black">)</font>;k<font color="black">+</font><font color="black">+</font><font color="black">)</font>
                <font color="black">{</font>
                    Program p;
                    Renderer<font color="black">:</font><font color="black">:</font>UseMaterial<font color="black">(</font>k<font color="black">-</font><font color="black">&#62;</font>material<font color="black">)</font>;
                    <font color="blue">if</font> <font color="black">(</font>node.GetProgram<font color="black">(</font><font color="black">)</font> <font color="black">&</font><font color="black">&</font> node.GetProgram<font color="black">(</font><font color="black">)</font>.IsValid<font color="black">(</font><font color="black">)</font><font color="black">)</font>
                        p<font color="black">=</font>node.GetProgram<font color="black">(</font><font color="black">)</font>;
                    <font color="blue">else</font>
                    <font color="black">{</font>
                        RenderState rs;
                        rs.FromMaterial<font color="black">(</font>k<font color="black">-</font><font color="black">&#62;</font>material<font color="black">)</font>;
                        <font color="blue">if</font> <font color="black">(</font>node.GetRenderParameters<font color="black">(</font><font color="black">)</font>.lighting<font color="black">)</font>
                        <font color="black">{</font>
                            <font color="blue">if</font> <font color="black">(</font>i<font color="black">-</font><font color="black">&#62;</font>second.GetType<font color="black">(</font><font color="black">)</font><font color="black">=</font><font color="black">=</font>DIRECTIONAL<font color="black">)</font>
                                rs.SetDirectionalLighting<font color="black">(</font><font color="blue">true</font><font color="black">)</font>;                
                            <font color="blue">else</font> <font color="blue">if</font> <font color="black">(</font>i<font color="black">-</font><font color="black">&#62;</font>second.GetType<font color="black">(</font><font color="black">)</font><font color="black">=</font><font color="black">=</font>POINT<font color="black">)</font>
                                rs.SetPointLighting<font color="black">(</font><font color="blue">true</font><font color="black">)</font>;
                        <font color="black">}</font>

                        rs.SetFog<font color="black">(</font>node.GetRenderParameters<font color="black">(</font><font color="black">)</font>.fog<font color="black">)</font>;
                        Technique technique<font color="black">=</font>node.GetTechnique<font color="black">(</font><font color="black">)</font>;
                        <font color="blue">if</font> <font color="black">(</font>technique<font color="black">)</font>
                            p<font color="black">=</font>technique.GenerateProgram<font color="black">(</font>rs<font color="black">)</font>;
                        <font color="blue">if</font> <font color="black">(</font><font color="black">!</font>p<font color="black">)</font>
                            <font color="blue">break</font>;
                        Renderer<font color="black">:</font><font color="black">:</font>UseProgram<font color="black">(</font>p<font color="black">)</font>;
                        <font color="blue">if</font> <font color="black">(</font>node.GetRenderParameters<font color="black">(</font><font color="black">)</font>.lighting<font color="black">)</font>
                        <font color="black">{</font>                   
                            <font color="blue">if</font> <font color="black">(</font>i<font color="black">-</font><font color="black">&#62;</font>second.GetType<font color="black">(</font><font color="black">)</font><font color="black">=</font><font color="black">=</font>DIRECTIONAL<font color="black">)</font>
                            <font color="black">{</font>
                                p.SetUniform<font color="black">(</font><font color="maroon">"directionalLightDir"</font>,vec3<font color="black">(</font><font color="maroon">0</font>,<font color="maroon">0</font>,<font color="maroon">1</font><font color="black">)</font>.TransformNormal<font color="black">(</font>i<font color="black">-</font><font color="black">&#62;</font>first<font color="black">)</font><font color="black">)</font>;
                                p.SetUniform<font color="black">(</font><font color="maroon">"lightAmbient"</font>,i<font color="black">-</font><font color="black">&#62;</font>second.GetAmbientColor<font color="black">(</font><font color="black">)</font><font color="black">)</font>;
                                p.SetUniform<font color="black">(</font><font color="maroon">"lightDiffuse"</font>,i<font color="black">-</font><font color="black">&#62;</font>second.GetDiffuseColor<font color="black">(</font><font color="black">)</font><font color="black">)</font>;
                                p.SetUniform<font color="black">(</font><font color="maroon">"lightSpecular"</font>,i<font color="black">-</font><font color="black">&#62;</font>second.GetSpecularColor<font color="black">(</font><font color="black">)</font><font color="black">)</font>;                             
                            <font color="black">}</font>
                            <font color="blue">else</font> <font color="blue">if</font> <font color="black">(</font>i<font color="black">-</font><font color="black">&#62;</font>second.GetType<font color="black">(</font><font color="black">)</font><font color="black">=</font><font color="black">=</font>POINT<font color="black">)</font>
                            <font color="black">{</font>
                                p.SetUniform<font color="black">(</font><font color="maroon">"lightPosition"</font>,vec3<font color="black">(</font><font color="maroon">0</font>,<font color="maroon">0</font>,<font color="maroon">0</font><font color="black">)</font> <font color="black">*</font> i<font color="black">-</font><font color="black">&#62;</font>first<font color="black">)</font>;
                                p.SetUniform<font color="black">(</font><font color="maroon">"lightAmbient"</font>,i<font color="black">-</font><font color="black">&#62;</font>second.GetAmbientColor<font color="black">(</font><font color="black">)</font><font color="black">)</font>;
                                p.SetUniform<font color="black">(</font><font color="maroon">"lightDiffuse"</font>,i<font color="black">-</font><font color="black">&#62;</font>second.GetDiffuseColor<font color="black">(</font><font color="black">)</font><font color="black">)</font>;
                                p.SetUniform<font color="black">(</font><font color="maroon">"lightSpecular"</font>,i<font color="black">-</font><font color="black">&#62;</font>second.GetSpecularColor<font color="black">(</font><font color="black">)</font><font color="black">)</font>;                             
                            <font color="black">}</font>
                        <font color="black">}</font>
                        <font color="blue">if</font> <font color="black">(</font>node.GetRenderParameters<font color="black">(</font><font color="black">)</font>.fog<font color="black">)</font>
                        <font color="black">{</font>
                            <font color="blue">if</font> <font color="black">(</font>firstPass<font color="black">)</font>
                                p.SetUniform<font color="black">(</font><font color="maroon">"fogColor"</font>,node.GetRenderParameters<font color="black">(</font><font color="black">)</font>.fogColor<font color="black">)</font>;
                            <font color="blue">else</font>
                                p.SetUniform<font color="black">(</font><font color="maroon">"fogColor"</font>,vec4<font color="black">(</font><font color="maroon">0</font>,<font color="maroon">0</font>,<font color="maroon">0</font>,<font color="maroon">0</font><font color="black">)</font><font color="black">)</font>;
                            p.SetUniform<font color="black">(</font><font color="maroon">"fogDensity"</font>,node.GetRenderParameters<font color="black">(</font><font color="black">)</font>.fogDensity<font color="black">)</font>;
                        <font color="black">}</font>   
                    <font color="black">}</font>
                    Renderer<font color="black">:</font><font color="black">:</font>UseProgram<font color="black">(</font>p<font color="black">)</font>;
                    <font color="blue">if</font> <font color="black">(</font>geometry.resource<font color="black">-</font><font color="black">&#62;</font>tangentBuffer<font color="black">)</font>
                        p.SetAttribute<font color="black">(</font><font color="maroon">"atrTangent"</font>,geometry.resource<font color="black">-</font><font color="black">&#62;</font>tangentBuffer,<font color="maroon">3</font><font color="black">)</font>;
                    <font color="blue">if</font> <font color="black">(</font>geometry.resource<font color="black">-</font><font color="black">&#62;</font>bitangentBuffer<font color="black">)</font>
                        p.SetAttribute<font color="black">(</font><font color="maroon">"atrBitangent"</font>,geometry.resource<font color="black">-</font><font color="black">&#62;</font>bitangentBuffer,<font color="maroon">3</font><font color="black">)</font>;
                    <font color="blue">if</font> <font color="black">(</font>k<font color="black">-</font><font color="black">&#62;</font>material.GetDiffuseTexture<font color="black">(</font><font color="black">)</font><font color="black">)</font>
                        p.SetUniform<font color="black">(</font><font color="maroon">"diffuseMap"</font>,<font color="maroon">0</font><font color="black">)</font>;
                    <font color="blue">if</font> <font color="black">(</font>k<font color="black">-</font><font color="black">&#62;</font>material.GetNormalTexture<font color="black">(</font><font color="black">)</font><font color="black">)</font>
                        p.SetUniform<font color="black">(</font><font color="maroon">"normalMap"</font>,<font color="maroon">1</font><font color="black">)</font>;
                    <font color="blue">if</font> <font color="black">(</font>k<font color="black">-</font><font color="black">&#62;</font>indexBuffer<font color="black">)</font>
                        k<font color="black">-</font><font color="black">&#62;</font>indexBuffer.SetIndexStream<font color="black">(</font><font color="black">)</font>;
                    Renderer<font color="black">:</font><font color="black">:</font>RenderIndexStream<font color="black">(</font>TRIANGLES,k<font color="black">-</font><font color="black">&#62;</font>face.size<font color="black">(</font><font color="black">)</font><font color="black">*</font><font color="maroon">3</font><font color="black">)</font>;
                    
                <font color="black">}</font>
                Renderer<font color="black">:</font><font color="black">:</font>RestoreModelViewMatrix<font color="black">(</font><font color="black">)</font>;
            <font color="black">}</font>
        <font color="black">}</font>
        firstPass<font color="black">=</font><font color="blue">false</font>;
    <font color="black">}</font>
    glDepthMask<font color="black">(</font><font color="blue">true</font><font color="black">)</font>;
    glDisable<font color="black">(</font>GL_BLEND<font color="black">)</font>;
    <font color="blue">for</font> <font color="black">(</font>j<font color="black">=</font>renderingQueue.begin<font color="black">(</font><font color="black">)</font>;j<font color="black">!</font><font color="black">=</font>renderingQueue.end<font color="black">(</font><font color="black">)</font>;j<font color="black">+</font><font color="black">+</font><font color="black">)</font>
    <font color="black">{</font>
        Geometry geometry<font color="black">=</font>j<font color="black">-</font><font color="black">&#62;</font>second.second;
        Node node<font color="black">=</font>j<font color="black">-</font><font color="black">&#62;</font>second.first;
        mat4 transformation<font color="black">=</font>j<font color="black">-</font><font color="black">&#62;</font>first;                               
        <font color="blue">if</font> <font color="black">(</font><font color="black">!</font>node.GetRenderParameters<font color="black">(</font><font color="black">)</font>.lighting<font color="black">)</font>
        <font color="black">{</font>           
            Renderer<font color="black">:</font><font color="black">:</font>SaveModelViewMatrix<font color="black">(</font><font color="black">)</font>;
            Renderer<font color="black">:</font><font color="black">:</font>MultiplyModelViewMatrix<font color="black">(</font>transformation<font color="black">)</font>;          
            <font color="green">//Renderer::Render(geometry);</font>

            vector<font color="black">&#60;</font>Surface<font color="black">&#62;</font><font color="black">:</font><font color="black">:</font>iterator k<font color="black">=</font>geometry.resource<font color="black">-</font><font color="black">&#62;</font>surface.begin<font color="black">(</font><font color="black">)</font>;
            <font color="blue">if</font> <font color="black">(</font>geometry.resource<font color="black">-</font><font color="black">&#62;</font>vertexBuffer<font color="black">)</font>
                geometry.resource<font color="black">-</font><font color="black">&#62;</font>vertexBuffer.SetVertexStream<font color="black">(</font><font color="maroon">3</font><font color="black">)</font>;
            <font color="blue">if</font> <font color="black">(</font>geometry.resource<font color="black">-</font><font color="black">&#62;</font>diffuseUVBuffer<font color="black">)</font>
                geometry.resource<font color="black">-</font><font color="black">&#62;</font>diffuseUVBuffer.SetTexCoordStream<font color="black">(</font><font color="maroon">0</font><font color="black">)</font>;
            <font color="blue">else</font>
                Renderer<font color="black">:</font><font color="black">:</font>DisableTexCoordStream<font color="black">(</font><font color="maroon">0</font><font color="black">)</font>;
            <font color="blue">if</font> <font color="black">(</font>geometry.resource<font color="black">-</font><font color="black">&#62;</font>normalBuffer<font color="black">)</font>
                geometry.resource<font color="black">-</font><font color="black">&#62;</font>normalBuffer.SetNormalStream<font color="black">(</font><font color="black">)</font>;
            <font color="blue">else</font>
                Renderer<font color="black">:</font><font color="black">:</font>DisableNormalStream<font color="black">(</font><font color="black">)</font>;
            <font color="blue">for</font> <font color="black">(</font>;k<font color="black">!</font><font color="black">=</font>geometry.resource<font color="black">-</font><font color="black">&#62;</font>surface.end<font color="black">(</font><font color="black">)</font>;k<font color="black">+</font><font color="black">+</font><font color="black">)</font>
            <font color="black">{</font>
                Program p;
                Renderer<font color="black">:</font><font color="black">:</font>UseMaterial<font color="black">(</font>k<font color="black">-</font><font color="black">&#62;</font>material<font color="black">)</font>;
                <font color="blue">if</font> <font color="black">(</font>node.GetProgram<font color="black">(</font><font color="black">)</font> <font color="black">&</font><font color="black">&</font> node.GetProgram<font color="black">(</font><font color="black">)</font>.IsValid<font color="black">(</font><font color="black">)</font><font color="black">)</font>
                    p<font color="black">=</font>node.GetProgram<font color="black">(</font><font color="black">)</font>;
                <font color="blue">else</font>
                <font color="black">{</font>
                    RenderState rs;
                    rs.FromMaterial<font color="black">(</font>k<font color="black">-</font><font color="black">&#62;</font>material<font color="black">)</font>;                   

                    rs.SetFog<font color="black">(</font>node.GetRenderParameters<font color="black">(</font><font color="black">)</font>.fog<font color="black">)</font>;
                    rs.SetDirectionalLighting<font color="black">(</font><font color="blue">false</font><font color="black">)</font>;
                    rs.SetPointLighting<font color="black">(</font><font color="blue">false</font><font color="black">)</font>;
                    Technique technique<font color="black">=</font>node.GetTechnique<font color="black">(</font><font color="black">)</font>;
                    <font color="blue">if</font> <font color="black">(</font>technique<font color="black">)</font>
                        p<font color="black">=</font>technique.GenerateProgram<font color="black">(</font>rs<font color="black">)</font>;    
                    <font color="blue">if</font> <font color="black">(</font><font color="black">!</font>p<font color="black">)</font>
                        <font color="blue">break</font>;
                    Renderer<font color="black">:</font><font color="black">:</font>UseProgram<font color="black">(</font>p<font color="black">)</font>;                    
                    <font color="blue">if</font> <font color="black">(</font>node.GetRenderParameters<font color="black">(</font><font color="black">)</font>.fog<font color="black">)</font>
                    <font color="black">{</font>
                        p.SetUniform<font color="black">(</font><font color="maroon">"fogColor"</font>,node.GetRenderParameters<font color="black">(</font><font color="black">)</font>.fogColor<font color="black">)</font>;
                        p.SetUniform<font color="black">(</font><font color="maroon">"fogDensity"</font>,node.GetRenderParameters<font color="black">(</font><font color="black">)</font>.fogDensity<font color="black">)</font>;
                    <font color="black">}</font>   
                <font color="black">}</font>
                Renderer<font color="black">:</font><font color="black">:</font>UseProgram<font color="black">(</font>p<font color="black">)</font>;
                <font color="blue">if</font> <font color="black">(</font>geometry.resource<font color="black">-</font><font color="black">&#62;</font>tangentBuffer<font color="black">)</font>
                    p.SetAttribute<font color="black">(</font><font color="maroon">"atrTangent"</font>,geometry.resource<font color="black">-</font><font color="black">&#62;</font>tangentBuffer,<font color="maroon">3</font><font color="black">)</font>;
                <font color="blue">if</font> <font color="black">(</font>geometry.resource<font color="black">-</font><font color="black">&#62;</font>bitangentBuffer<font color="black">)</font>
                    p.SetAttribute<font color="black">(</font><font color="maroon">"atrBitangent"</font>,geometry.resource<font color="black">-</font><font color="black">&#62;</font>bitangentBuffer,<font color="maroon">3</font><font color="black">)</font>;
                <font color="blue">if</font> <font color="black">(</font>k<font color="black">-</font><font color="black">&#62;</font>material.GetDiffuseTexture<font color="black">(</font><font color="black">)</font><font color="black">)</font>
                    p.SetUniform<font color="black">(</font><font color="maroon">"diffuseMap"</font>,<font color="maroon">0</font><font color="black">)</font>;
                <font color="blue">if</font> <font color="black">(</font>k<font color="black">-</font><font color="black">&#62;</font>indexBuffer<font color="black">)</font>
                    k<font color="black">-</font><font color="black">&#62;</font>indexBuffer.SetIndexStream<font color="black">(</font><font color="black">)</font>;                
                Renderer<font color="black">:</font><font color="black">:</font>RenderIndexStream<font color="black">(</font>TRIANGLES,k<font color="black">-</font><font color="black">&#62;</font>face.size<font color="black">(</font><font color="black">)</font><font color="black">*</font><font color="maroon">3</font><font color="black">)</font>;
            <font color="black">}</font>   
            Renderer<font color="black">:</font><font color="black">:</font>RestoreModelViewMatrix<font color="black">(</font><font color="black">)</font>;
        <font color="black">}</font>
    <font color="black">}</font>
<font color="black">}</font>
<font color="blue">void</font> FIRECUBE_API Renderer<font color="black">:</font><font color="black">:</font>AddTechnique<font color="black">(</font><font color="blue">const</font> std<font color="black">:</font><font color="black">:</font>string <font color="black">&</font><font color="blue">name</font>, Technique technique<font color="black">)</font>
<font color="black">{</font>
    techniques<font color="black">[</font><font color="blue">name</font><font color="black">]</font><font color="black">=</font>technique;
<font color="black">}</font>
Technique FIRECUBE_API Renderer<font color="black">:</font><font color="black">:</font>GetTechnique<font color="black">(</font><font color="blue">const</font> std<font color="black">:</font><font color="black">:</font>string <font color="black">&</font><font color="blue">name</font><font color="black">)</font>
<font color="black">{</font>
    map<font color="black">&#60;</font>string, Technique<font color="black">&#62;</font><font color="black">:</font><font color="black">:</font>iterator i<font color="black">=</font>techniques.find<font color="black">(</font><font color="blue">name</font><font color="black">)</font>;
    <font color="blue">if</font> <font color="black">(</font>i<font color="black">!</font><font color="black">=</font>techniques.end<font color="black">(</font><font color="black">)</font><font color="black">)</font>
        <font color="blue">return</font> i<font color="black">-</font><font color="black">&#62;</font>second;
    <font color="blue">return</font> Technique<font color="black">(</font><font color="black">)</font>;
<font color="black">}</font>
<font color="blue">void</font> FIRECUBE_API Renderer<font color="black">:</font><font color="black">:</font>RemoveTechnique<font color="black">(</font><font color="blue">const</font> std<font color="black">:</font><font color="black">:</font>string <font color="black">&</font><font color="blue">name</font><font color="black">)</font>
<font color="black">{</font>
    map<font color="black">&#60;</font>string, Technique<font color="black">&#62;</font><font color="black">:</font><font color="black">:</font>iterator i<font color="black">=</font>techniques.find<font color="black">(</font><font color="blue">name</font><font color="black">)</font>;
    <font color="blue">if</font> <font color="black">(</font>i<font color="black">!</font><font color="black">=</font>techniques.end<font color="black">(</font><font color="black">)</font><font color="black">)</font>    
        techniques.erase<font color="black">(</font>i<font color="black">)</font>;    
<font color="black">}</font>
</PRE>
</BODY>
</HTML>
