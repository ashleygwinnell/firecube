<HTML>
<HEAD>
<TITLE>
m3dsLoader.cpp
</TITLE>
</HEAD>
<BODY>
<PRE>
<font color="blue">#include</font> <font color="maroon">&#60;string&#62;</font>
<font color="blue">#include</font> <font color="maroon">&#60;vector&#62;</font>
<font color="blue">#include</font> <font color="maroon">&#60;map&#62;</font>
<font color="blue">#include</font> <font color="maroon">&#60;fstream&#62;</font>
<font color="blue">#include</font> <font color="maroon">&#60;boost/shared_ptr.hpp&#62;</font>
<font color="blue">#include</font> <font color="maroon">&#60;boost/weak_ptr.hpp&#62;</font>
<font color="blue">using</font> <font color="blue">namespace</font> std;
<font color="blue">#include</font> <font color="maroon">&#60;SDL/SDL.h&#62;</font>
<font color="blue">#include</font> <font color="maroon">&#60;windows.h&#62;</font>
<font color="blue">#include</font> <font color="maroon">"GLee.h"</font>
<font color="blue">#include</font> <font color="maroon">"FireCube.h"</font>
<font color="blue">using</font> <font color="blue">namespace</font> FireCube;
<font color="blue">#include</font> <font color="maroon">&#60;dae.h&#62;</font>
<font color="blue">#include</font> <font color="maroon">&#60;dom/domCOLLADA.h&#62;</font>
<font color="blue">#include</font> <font color="maroon">"ModelLoaders.h"</font>


M3dsLoader<font color="black">:</font><font color="black">:</font>M3dsLoader<font color="black">(</font>ModelResource <font color="black">*</font>model<font color="black">)</font> <font color="black">:</font> model<font color="black">(</font>model<font color="black">)</font>
<font color="black">{</font>

<font color="black">}</font>
<font color="blue">bool</font> M3dsLoader<font color="black">:</font><font color="black">:</font>Load<font color="black">(</font><font color="blue">const</font> string <font color="black">&</font>filename<font color="black">)</font>
<font color="black">{</font>
    ifstream f<font color="black">(</font>filename.c_str<font color="black">(</font><font color="black">)</font>,ios<font color="black">:</font><font color="black">:</font>in<font color="black">|</font>ios<font color="black">:</font><font color="black">:</font>binary<font color="black">|</font>ios<font color="black">:</font><font color="black">:</font>ate<font color="black">)</font>;
    <font color="blue">if</font> <font color="black">(</font><font color="black">!</font>f.is_open<font color="black">(</font><font color="black">)</font><font color="black">)</font>
        <font color="blue">return</font> <font color="blue">false</font>;
    
    DWORD l<font color="black">=</font>f.tellg<font color="black">(</font><font color="black">)</font>;
    <font color="blue">char</font> <font color="black">*</font>buffer<font color="black">=</font><font color="blue">new</font> <font color="blue">char</font><font color="black">[</font>l<font color="black">]</font>;
    f.seekg<font color="black">(</font><font color="maroon">0</font>,ios_base<font color="black">:</font><font color="black">:</font>beg<font color="black">)</font>;
    f.read<font color="black">(</font>buffer,l<font color="black">)</font>;

    ProcessChunk<font color="black">(</font>buffer<font color="black">)</font>;   
    <font color="blue">for</font> <font color="black">(</font>DWORD k<font color="black">=</font><font color="maroon">0</font>;k<font color="black">&#60;</font>model<font color="black">-</font><font color="black">&#62;</font>object.size<font color="black">(</font><font color="black">)</font>;k<font color="black">+</font><font color="black">+</font><font color="black">)</font>
    <font color="black">{</font>
        <font color="blue">for</font> <font color="black">(</font>DWORD i<font color="black">=</font><font color="maroon">0</font>;i<font color="black">&#60;</font>model<font color="black">-</font><font color="black">&#62;</font>object<font color="black">[</font>k<font color="black">]</font>.mesh.size<font color="black">(</font><font color="black">)</font>;i<font color="black">+</font><font color="black">+</font><font color="black">)</font>
        <font color="black">{</font>
            Mesh <font color="black">*</font>sm<font color="black">=</font><font color="black">&</font>model<font color="black">-</font><font color="black">&#62;</font>object<font color="black">[</font>k<font color="black">]</font>.mesh<font color="black">[</font>i<font color="black">]</font>;     
            <font color="blue">for</font> <font color="black">(</font>DWORD j<font color="black">=</font><font color="maroon">0</font>;j<font color="black">&#60;</font>sm<font color="black">-</font><font color="black">&#62;</font>face.size<font color="black">(</font><font color="black">)</font>;j<font color="black">+</font><font color="black">+</font><font color="black">)</font>
            <font color="black">{</font>
                DWORD idx<font color="black">=</font>sm<font color="black">-</font><font color="black">&#62;</font>face<font color="black">[</font>j<font color="black">]</font>.v<font color="black">[</font><font color="maroon">0</font><font color="black">]</font>;
                sm<font color="black">-</font><font color="black">&#62;</font>face<font color="black">[</font>j<font color="black">]</font><font color="black">=</font>model<font color="black">-</font><font color="black">&#62;</font>object<font color="black">[</font>k<font color="black">]</font>.face<font color="black">[</font>idx<font color="black">]</font>;             
            <font color="black">}</font>           
        <font color="black">}</font>
    <font color="black">}</font>
    model<font color="black">-</font><font color="black">&#62;</font>CalculateNormals<font color="black">(</font><font color="black">)</font>;
    model<font color="black">-</font><font color="black">&#62;</font>UpdateBuffers<font color="black">(</font><font color="black">)</font>;
    <font color="blue">delete</font> <font color="black">[</font><font color="black">]</font> buffer;       
    <font color="blue">return</font> <font color="blue">true</font>;
<font color="black">}</font>
DWORD M3dsLoader<font color="black">:</font><font color="black">:</font>ProcessChunk<font color="black">(</font><font color="blue">char</font> <font color="black">*</font>buffer<font color="black">)</font>
<font color="black">{</font>
    Object <font color="black">*</font>curObject<font color="black">=</font>NULL;
    <font color="blue">if</font> <font color="black">(</font>model<font color="black">-</font><font color="black">&#62;</font>object.size<font color="black">(</font><font color="black">)</font><font color="black">&#62;</font><font color="maroon">0</font><font color="black">)</font>
        curObject<font color="black">=</font><font color="black">&</font>model<font color="black">-</font><font color="black">&#62;</font>object<font color="black">[</font>model<font color="black">-</font><font color="black">&#62;</font>object.size<font color="black">(</font><font color="black">)</font><font color="maroon">-1</font><font color="black">]</font>;
    DWORD i<font color="black">=</font><font color="maroon">0</font>,j<font color="black">=</font><font color="maroon">0</font>;  
    Material mat;
    Material matPtr;
    Mesh sm;
    DWORD numtexcoords,numFaces,numVertices;
    WORD id<font color="black">=</font><font color="black">*</font><font color="black">(</font>WORD<font color="black">*</font><font color="black">)</font><font color="black">(</font>buffer<font color="black">+</font>i<font color="black">)</font>;
    DWORD len<font color="black">=</font><font color="black">*</font><font color="black">(</font>DWORD<font color="black">*</font><font color="black">)</font><font color="black">(</font>buffer<font color="black">+</font>i<font color="black">+</font><font color="maroon">2</font><font color="black">)</font>;        
    i<font color="black">+</font><font color="black">=</font><font color="maroon">6</font>;
    <font color="blue">switch</font> <font color="black">(</font>id<font color="black">)</font>
    <font color="black">{</font>
    <font color="blue">case</font> PRIMARY<font color="black">:</font>
        <font color="blue">break</font>;
    <font color="blue">case</font> EDIT3DS<font color="black">:</font>
        <font color="blue">break</font>;
    <font color="blue">case</font> NAMED_OBJECT<font color="black">:</font>
        model<font color="black">-</font><font color="black">&#62;</font>object.push_back<font color="black">(</font>Object<font color="black">(</font><font color="black">)</font><font color="black">)</font>;
        model<font color="black">-</font><font color="black">&#62;</font>object<font color="black">[</font>model<font color="black">-</font><font color="black">&#62;</font>object.size<font color="black">(</font><font color="black">)</font><font color="maroon">-1</font><font color="black">]</font>.<font color="blue">name</font><font color="black">=</font>buffer<font color="black">+</font>i;            
        i<font color="black">+</font><font color="black">=</font><font color="black">(</font>DWORD<font color="black">)</font>strlen<font color="black">(</font>buffer<font color="black">+</font>i<font color="black">)</font><font color="black">+</font><font color="maroon">1</font>;
        <font color="blue">break</font>;
    <font color="blue">case</font> OBJ_MESH<font color="black">:</font>
        <font color="blue">break</font>;
    <font color="blue">case</font> MESH_VERTICES<font color="black">:</font>         
        <font color="blue">float</font> x,y,z;
        numVertices<font color="black">=</font><font color="black">*</font><font color="black">(</font>WORD<font color="black">*</font><font color="black">)</font><font color="black">(</font>buffer<font color="black">+</font>i<font color="black">)</font>;
        curObject<font color="black">-</font><font color="black">&#62;</font>vertex.resize<font color="black">(</font>numVertices<font color="black">)</font>;
        i<font color="black">+</font><font color="black">=</font><font color="maroon">2</font>;
        <font color="blue">for</font> <font color="black">(</font>j<font color="black">=</font><font color="maroon">0</font>;j<font color="black">&#60;</font>numVertices;j<font color="black">+</font><font color="black">+</font><font color="black">)</font>
        <font color="black">{</font>
            x<font color="black">=</font><font color="black">*</font><font color="black">(</font><font color="blue">float</font><font color="black">*</font><font color="black">)</font><font color="black">(</font>buffer<font color="black">+</font>i<font color="black">)</font>;
            z<font color="black">=</font><font color="black">-</font><font color="black">*</font><font color="black">(</font><font color="blue">float</font><font color="black">*</font><font color="black">)</font><font color="black">(</font>buffer<font color="black">+</font>i<font color="black">+</font><font color="maroon">4</font><font color="black">)</font>;
            y<font color="black">=</font><font color="black">*</font><font color="black">(</font><font color="blue">float</font><font color="black">*</font><font color="black">)</font><font color="black">(</font>buffer<font color="black">+</font>i<font color="black">+</font><font color="maroon">8</font><font color="black">)</font>;
            curObject<font color="black">-</font><font color="black">&#62;</font>vertex<font color="black">[</font>j<font color="black">]</font>.Set<font color="black">(</font>x,y,z<font color="black">)</font>;
            i<font color="black">+</font><font color="black">=</font><font color="maroon">12</font>;
        <font color="black">}</font>       
        <font color="blue">break</font>;
    <font color="blue">case</font> MESH_FACES<font color="black">:</font>            
        numFaces<font color="black">=</font><font color="black">*</font><font color="black">(</font>WORD<font color="black">*</font><font color="black">)</font><font color="black">(</font>buffer<font color="black">+</font>i<font color="black">)</font>;
        i<font color="black">+</font><font color="black">=</font><font color="maroon">2</font>;
        curObject<font color="black">-</font><font color="black">&#62;</font>face.resize<font color="black">(</font>numFaces<font color="black">)</font>;
        <font color="blue">for</font> <font color="black">(</font>j<font color="black">=</font><font color="maroon">0</font>;j<font color="black">&#60;</font>numFaces;j<font color="black">+</font><font color="black">+</font><font color="black">)</font>
        <font color="black">{</font>
            curObject<font color="black">-</font><font color="black">&#62;</font>face<font color="black">[</font>j<font color="black">]</font>.v<font color="black">[</font><font color="maroon">0</font><font color="black">]</font><font color="black">=</font><font color="black">*</font><font color="black">(</font>WORD<font color="black">*</font><font color="black">)</font><font color="black">(</font>buffer<font color="black">+</font>i<font color="black">)</font>;
            curObject<font color="black">-</font><font color="black">&#62;</font>face<font color="black">[</font>j<font color="black">]</font>.v<font color="black">[</font><font color="maroon">1</font><font color="black">]</font><font color="black">=</font><font color="black">*</font><font color="black">(</font>WORD<font color="black">*</font><font color="black">)</font><font color="black">(</font>buffer<font color="black">+</font>i<font color="black">+</font><font color="maroon">2</font><font color="black">)</font>;
            curObject<font color="black">-</font><font color="black">&#62;</font>face<font color="black">[</font>j<font color="black">]</font>.v<font color="black">[</font><font color="maroon">2</font><font color="black">]</font><font color="black">=</font><font color="black">*</font><font color="black">(</font>WORD<font color="black">*</font><font color="black">)</font><font color="black">(</font>buffer<font color="black">+</font>i<font color="black">+</font><font color="maroon">4</font><font color="black">)</font>;
            i<font color="black">+</font><font color="black">=</font><font color="maroon">8</font>;
        <font color="black">}</font>
        <font color="blue">break</font>;
    <font color="blue">case</font> MESH_TEX_VERT<font color="black">:</font>
        numtexcoords<font color="black">=</font><font color="black">*</font><font color="black">(</font>WORD<font color="black">*</font><font color="black">)</font><font color="black">(</font>buffer<font color="black">+</font>i<font color="black">)</font>;
        curObject<font color="black">-</font><font color="black">&#62;</font>uv<font color="black">[</font><font color="maroon">0</font><font color="black">]</font>.resize<font color="black">(</font>numtexcoords<font color="black">)</font>;
        i<font color="black">+</font><font color="black">=</font><font color="maroon">2</font>;
        <font color="blue">for</font> <font color="black">(</font>j<font color="black">=</font><font color="maroon">0</font>;j<font color="black">&#60;</font>numtexcoords;j<font color="black">+</font><font color="black">+</font><font color="black">)</font>
        <font color="black">{</font>
            curObject<font color="black">-</font><font color="black">&#62;</font>uv<font color="black">[</font><font color="maroon">0</font><font color="black">]</font><font color="black">[</font>j<font color="black">]</font>.x<font color="black">=</font><font color="black">*</font><font color="black">(</font><font color="blue">float</font><font color="black">*</font><font color="black">)</font><font color="black">(</font>buffer<font color="black">+</font>i<font color="black">)</font>;
            curObject<font color="black">-</font><font color="black">&#62;</font>uv<font color="black">[</font><font color="maroon">0</font><font color="black">]</font><font color="black">[</font>j<font color="black">]</font>.y<font color="black">=</font><font color="maroon">1</font>.0f<font color="black">-</font><font color="black">*</font><font color="black">(</font><font color="blue">float</font><font color="black">*</font><font color="black">)</font><font color="black">(</font>buffer<font color="black">+</font>i<font color="black">+</font><font color="maroon">4</font><font color="black">)</font>;
            i<font color="black">+</font><font color="black">=</font><font color="maroon">8</font>;
        <font color="black">}</font>       
        <font color="blue">break</font>;
    <font color="blue">case</font> MESH_MATERIAL<font color="black">:</font>     
        sm.material<font color="black">=</font>model<font color="black">-</font><font color="black">&#62;</font>GetMaterialByName<font color="black">(</font>buffer<font color="black">+</font>i<font color="black">)</font>;
        i<font color="black">+</font><font color="black">=</font><font color="black">(</font>DWORD<font color="black">)</font>strlen<font color="black">(</font>buffer<font color="black">+</font>i<font color="black">)</font><font color="black">+</font><font color="maroon">1</font>;
        numFaces<font color="black">=</font><font color="black">*</font><font color="black">(</font>WORD<font color="black">*</font><font color="black">)</font><font color="black">(</font>buffer<font color="black">+</font>i<font color="black">)</font>;
        i<font color="black">+</font><font color="black">=</font><font color="maroon">2</font>;
        sm.face.resize<font color="black">(</font>numFaces<font color="black">)</font>;
        <font color="blue">for</font> <font color="black">(</font>j<font color="black">=</font><font color="maroon">0</font>;j<font color="black">&#60;</font>numFaces;j<font color="black">+</font><font color="black">+</font><font color="black">)</font>
        <font color="black">{</font>
            sm.face<font color="black">[</font>j<font color="black">]</font>.v<font color="black">[</font><font color="maroon">0</font><font color="black">]</font><font color="black">=</font><font color="black">*</font><font color="black">(</font>WORD<font color="black">*</font><font color="black">)</font><font color="black">(</font>buffer<font color="black">+</font>i<font color="black">)</font>;
            i<font color="black">+</font><font color="black">=</font><font color="maroon">2</font>;
        <font color="black">}</font>           
        curObject<font color="black">-</font><font color="black">&#62;</font>mesh.push_back<font color="black">(</font>sm<font color="black">)</font>;
        <font color="blue">break</font>;
    <font color="blue">case</font> MATERIAL<font color="black">:</font>
        <font color="blue">break</font>;
    <font color="blue">case</font> MAT_NAME<font color="black">:</font>              
        mat<font color="black">=</font>Material<font color="black">(</font><font color="blue">new</font> MaterialResource<font color="black">)</font>;
        mat<font color="black">-</font><font color="black">&#62;</font><font color="blue">name</font><font color="black">=</font>buffer<font color="black">+</font>i;     
        model<font color="black">-</font><font color="black">&#62;</font>material.insert<font color="black">(</font>model<font color="black">-</font><font color="black">&#62;</font>material.begin<font color="black">(</font><font color="black">)</font>,mat<font color="black">)</font>;        
        i<font color="black">+</font><font color="black">=</font><font color="black">(</font>DWORD<font color="black">)</font>strlen<font color="black">(</font>buffer<font color="black">+</font>i<font color="black">)</font><font color="black">+</font><font color="maroon">1</font>;       
        <font color="blue">break</font>;
    <font color="blue">case</font> MAT_AMBIENT<font color="black">:</font>
        i<font color="black">+</font><font color="black">=</font><font color="maroon">6</font>;
        matPtr<font color="black">=</font>model<font color="black">-</font><font color="black">&#62;</font>material<font color="black">[</font><font color="maroon">0</font><font color="black">]</font>;      
        matPtr<font color="black">-</font><font color="black">&#62;</font>ambient<font color="black">=</font>vec4<font color="black">(</font><font color="black">(</font><font color="blue">float</font><font color="black">)</font><font color="black">(</font><font color="black">*</font><font color="black">(</font>BYTE<font color="black">*</font><font color="black">)</font><font color="black">(</font>buffer<font color="black">+</font>i<font color="black">)</font><font color="black">)</font><font color="black">/</font><font color="maroon">255</font>.0f,<font color="black">(</font><font color="blue">float</font><font color="black">)</font><font color="black">(</font><font color="black">*</font><font color="black">(</font>BYTE<font color="black">*</font><font color="black">)</font><font color="black">(</font>buffer<font color="black">+</font>i<font color="black">+</font><font color="maroon">1</font><font color="black">)</font><font color="black">)</font><font color="black">/</font><font color="maroon">255</font>.0f,<font color="black">(</font><font color="blue">float</font><font color="black">)</font><font color="black">(</font><font color="black">*</font><font color="black">(</font>BYTE<font color="black">*</font><font color="black">)</font><font color="black">(</font>buffer<font color="black">+</font>i<font color="black">+</font><font color="maroon">2</font><font color="black">)</font><font color="black">)</font><font color="black">/</font><font color="maroon">255</font>.0f,<font color="maroon">1</font>.0f<font color="black">)</font>;
        i<font color="black">+</font><font color="black">=</font><font color="maroon">3</font>;
        <font color="blue">break</font>;
    <font color="blue">case</font> MAT_DIFFUSE<font color="black">:</font>
        i<font color="black">+</font><font color="black">=</font><font color="maroon">6</font>;
        matPtr<font color="black">=</font>model<font color="black">-</font><font color="black">&#62;</font>material<font color="black">[</font><font color="maroon">0</font><font color="black">]</font>;      
        matPtr<font color="black">-</font><font color="black">&#62;</font>diffuse<font color="black">=</font>vec4<font color="black">(</font><font color="black">(</font><font color="blue">float</font><font color="black">)</font><font color="black">(</font><font color="black">*</font><font color="black">(</font>BYTE<font color="black">*</font><font color="black">)</font><font color="black">(</font>buffer<font color="black">+</font>i<font color="black">)</font><font color="black">)</font><font color="black">/</font><font color="maroon">255</font>.0f,<font color="black">(</font><font color="blue">float</font><font color="black">)</font><font color="black">(</font><font color="black">*</font><font color="black">(</font>BYTE<font color="black">*</font><font color="black">)</font><font color="black">(</font>buffer<font color="black">+</font>i<font color="black">+</font><font color="maroon">1</font><font color="black">)</font><font color="black">)</font><font color="black">/</font><font color="maroon">255</font>.0f,<font color="black">(</font><font color="blue">float</font><font color="black">)</font><font color="black">(</font><font color="black">*</font><font color="black">(</font>BYTE<font color="black">*</font><font color="black">)</font><font color="black">(</font>buffer<font color="black">+</font>i<font color="black">+</font><font color="maroon">2</font><font color="black">)</font><font color="black">)</font><font color="black">/</font><font color="maroon">255</font>.0f,<font color="maroon">1</font>.0f<font color="black">)</font>;
        i<font color="black">+</font><font color="black">=</font><font color="maroon">3</font>;
        <font color="blue">break</font>;
    <font color="blue">case</font> MAT_SPECULAR<font color="black">:</font>
        i<font color="black">+</font><font color="black">=</font><font color="maroon">6</font>;
        matPtr<font color="black">=</font>model<font color="black">-</font><font color="black">&#62;</font>material<font color="black">[</font><font color="maroon">0</font><font color="black">]</font>;      
        matPtr<font color="black">-</font><font color="black">&#62;</font>specular<font color="black">=</font>vec4<font color="black">(</font><font color="black">(</font><font color="blue">float</font><font color="black">)</font><font color="black">(</font><font color="black">*</font><font color="black">(</font>BYTE<font color="black">*</font><font color="black">)</font><font color="black">(</font>buffer<font color="black">+</font>i<font color="black">)</font><font color="black">)</font><font color="black">/</font><font color="maroon">255</font>.0f,<font color="black">(</font><font color="blue">float</font><font color="black">)</font><font color="black">(</font><font color="black">*</font><font color="black">(</font>BYTE<font color="black">*</font><font color="black">)</font><font color="black">(</font>buffer<font color="black">+</font>i<font color="black">+</font><font color="maroon">1</font><font color="black">)</font><font color="black">)</font><font color="black">/</font><font color="maroon">255</font>.0f,<font color="black">(</font><font color="blue">float</font><font color="black">)</font><font color="black">(</font><font color="black">*</font><font color="black">(</font>BYTE<font color="black">*</font><font color="black">)</font><font color="black">(</font>buffer<font color="black">+</font>i<font color="black">+</font><font color="maroon">2</font><font color="black">)</font><font color="black">)</font><font color="black">/</font><font color="maroon">255</font>.0f,<font color="maroon">1</font>.0f<font color="black">)</font>;
        i<font color="black">+</font><font color="black">=</font><font color="maroon">3</font>;
        <font color="blue">break</font>;
    <font color="blue">case</font> MAT_SHININESS<font color="black">:</font>
        i<font color="black">+</font><font color="black">=</font><font color="maroon">6</font>;
        i<font color="black">+</font><font color="black">=</font><font color="maroon">2</font>;
        <font color="blue">break</font>;
    <font color="blue">case</font> MAT_SHIN2PCT<font color="black">:</font>
        i<font color="black">+</font><font color="black">=</font><font color="maroon">6</font>;
        matPtr<font color="black">=</font>model<font color="black">-</font><font color="black">&#62;</font>material<font color="black">[</font><font color="maroon">0</font><font color="black">]</font>;
        matPtr<font color="black">-</font><font color="black">&#62;</font>shininess<font color="black">=</font><font color="black">(</font><font color="blue">float</font><font color="black">)</font><font color="black">(</font><font color="black">*</font><font color="black">(</font>WORD<font color="black">*</font><font color="black">)</font><font color="black">(</font>buffer<font color="black">+</font>i<font color="black">)</font><font color="black">)</font>;
        i<font color="black">+</font><font color="black">=</font><font color="maroon">2</font>;
        <font color="blue">break</font>;
    <font color="blue">case</font> MAT_SHIN3PCT<font color="black">:</font>
        i<font color="black">+</font><font color="black">=</font><font color="maroon">6</font>;
        i<font color="black">+</font><font color="black">=</font><font color="maroon">2</font>;
        <font color="blue">break</font>;
    <font color="blue">case</font> MAT_TEXMAP<font color="black">:</font>
        i<font color="black">+</font><font color="black">=</font><font color="maroon">8</font>;
        <font color="blue">break</font>;
    <font color="blue">case</font> MAT_TEXFLNM<font color="black">:</font>
        matPtr<font color="black">=</font>model<font color="black">-</font><font color="black">&#62;</font>material<font color="black">[</font><font color="maroon">0</font><font color="black">]</font>;                      
        matPtr<font color="black">-</font><font color="black">&#62;</font>texture<font color="black">[</font><font color="maroon">0</font><font color="black">]</font><font color="black">=</font>Renderer<font color="black">:</font><font color="black">:</font>GetTextureManager<font color="black">(</font><font color="black">)</font><font color="black">-</font><font color="black">&#62;</font>Create<font color="black">(</font>buffer<font color="black">+</font>i<font color="black">)</font>;     
        i<font color="black">+</font><font color="black">=</font><font color="black">(</font>DWORD<font color="black">)</font>strlen<font color="black">(</font>buffer<font color="black">+</font>i<font color="black">)</font><font color="black">+</font><font color="maroon">1</font>;
        <font color="blue">break</font>;
    <font color="blue">default</font><font color="black">:</font>    
        i<font color="black">=</font>len;
        <font color="blue">break</font>;

    <font color="black">}</font>
    <font color="blue">while</font> <font color="black">(</font>i<font color="black">&#60;</font>len<font color="black">)</font>
        i<font color="black">+</font><font color="black">=</font>ProcessChunk<font color="black">(</font>buffer<font color="black">+</font>i<font color="black">)</font>;

    <font color="blue">return</font> len;
<font color="black">}</font>
</PRE>
</BODY>
</HTML>
